# Tranzilla Payment Integration

## üìã –û–±–∑–æ—Ä

ClientBase Pro –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π Tranzilla –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∫—Ä–µ–¥–∏—Ç–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö Tranzilla

**Sandbox (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ):**
- Terminal ID: `sandbox`
- API URL: `https://sandbox.tranzilla.co.il/cgi-bin/tranzilla71u.cgi`

**Production:**
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [tranzilla.com](https://www.tranzilla.com)
- –ü–æ–ª—É—á–∏—Ç–µ Terminal ID –∏ API Key
- –û–±–Ω–æ–≤–∏—Ç–µ `.env.local`

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
TRANZILLA_TERMINAL_ID=sandbox
TRANZILLA_API_KEY=your_api_key
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∑–∞–º–µ–Ω–∏—Ç–µ `NEXT_PUBLIC_APP_URL` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω!

## üéØ API Endpoints

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏

**POST** `/api/payments/create-link`

**Request:**
```json
{
  "client_id": "uuid",
  "amount": 100.00,
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞",
  "visit_id": "uuid (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
}
```

**Response:**
```json
{
  "success": true,
  "payment_id": "uuid",
  "payment_link": "https://sandbox.tranzilla.co.il/...",
  "amount": "100.00",
  "currency": "ILS"
}
```

### 2. Webhook (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Tranzilla)

**POST** `/api/payments/webhook`

–≠—Ç–æ—Ç endpoint –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Tranzilla –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã Tranzilla webhook:**
- `Response`: –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ ('000' = —É—Å–ø–µ—Ö)
- `ConfirmationCode`: ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `sum`: —Å—É–º–º–∞
- `currency`: –≤–∞–ª—é—Ç–∞
- `contact`: payment_id –∏–∑ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã

### 3. Callback (—Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã)

**GET** `/api/payments/callback?payment_id=uuid&status=success`

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—é–¥–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Tranzilla.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Sandbox)

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:

‚úÖ **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂:**
- –ù–æ–º–µ—Ä: `4444-3333-2222-1111`
- Exp: `01/26`
- CVV: `123`

‚ùå **–ù–µ—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂:**
- –ù–æ–º–µ—Ä: `4580-0000-0000-0002`
- Exp: `01/26`
- CVV: `123`

### Workflow —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –∫–ª–∏–µ–Ω—Ç–∞
3. –ù–∞–∂–º–∏—Ç–µ "◊¶◊ï◊® ◊ß◊ô◊©◊ï◊® ◊™◊©◊ú◊ï◊ù"
4. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
5. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫—Ä–æ–µ—Ç Tranzilla –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
6. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
7. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º—É
8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–µ "–ü–ª–∞—Ç–µ–∂–∏"

## üìä –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π

- **pending** - –ø–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞–Ω, –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- **completed** - –ø–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω
- **failed** - –ø–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª
- **refunded** - –ø–ª–∞—Ç—ë–∂ –≤–æ–∑–≤—Ä–∞—â—ë–Ω

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Production checklist:

- [ ] –ó–∞–º–µ–Ω–∏—Ç–µ sandbox credentials –Ω–∞ production
- [ ] –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS –¥–ª—è webhook endpoints
- [ ] –î–æ–±–∞–≤—å—Ç–µ IP whitelist –¥–ª—è webhook (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
- [ ] –í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ failed payments
- [ ] –î–æ–±–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö

## üêõ Troubleshooting

### Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** Tranzilla –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ –≤–∞—à–µ–≥–æ localhost.

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [ngrok](https://ngrok.com) –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è:
   ```bash
   ngrok http 3000
   ```
2. –û–±–Ω–æ–≤–∏—Ç–µ `NEXT_PUBLIC_APP_URL` –≤ `.env.local` –Ω–∞ ngrok URL
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ webhook URL –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### –ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ —Å—Ç–∞—Ç—É—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook: `/api/payments/webhook`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `payment_id` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Supabase

### –°—Å—ã–ª–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TRANZILLA_TERMINAL_ID` –≤ `.env.local`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å—É–º–º–∞ > 0
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ URL

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Tranzilla

- [API Documentation](https://www.tranzilla.com/docs/)
- [Hosted Page Integration](https://www.tranzilla.com/docs/hosted-page/)
- [Webhook Configuration](https://www.tranzilla.com/docs/webhooks/)

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### Recurring Payments (–ø–æ–¥–ø–∏—Å–∫–∏)
Tranzilla –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏. –î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `recurrence` –≤ —Ç–∞–±–ª–∏—Ü—É payments
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ø–∏—Å–∞–Ω–∏–π
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Tranzilla Token API

### Partial Refunds (—á–∞—Å—Ç–∏—á–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç—ã)
–ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ Tranzilla API.

### Multi-currency (–º—É–ª—å—Ç–∏-–≤–∞–ª—é—Ç–∞)
Tranzilla –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç USD, EUR –∏ –¥—Ä—É–≥–∏–µ –≤–∞–ª—é—Ç—ã.
