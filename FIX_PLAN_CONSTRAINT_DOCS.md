# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ constraint –¥–ª—è –ø–æ–ª—è plan

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω "custom" –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
violates check constraint organizations_plan_check
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í —Ç–∞–±–ª–∏—Ü–µ `organizations` constraint —Ä–∞–∑—Ä–µ—à–∞–ª —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—è `plan`, –∏ "custom" –Ω–µ –≤—Ö–æ–¥–∏–ª –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–∞–∑–≤–∞–Ω–∏—è 'professional' –∏ 'corporate', –∞ –≤ –±–∞–∑–µ –æ–∂–∏–¥–∞–ª–∏—Å—å 'pro' –∏ 'enterprise'.

---

## –†–µ—à–µ–Ω–∏–µ

### 1. SQL –º–∏–≥—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `FIX_PLAN_CONSTRAINT.sql`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è `plan` –≤ –±–∞–∑–µ
2. –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π constraint
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   - `'professional'` ‚Üí `'pro'`
   - `'corporate'` ‚Üí `'enterprise'`
4. –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π constraint —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π: `'demo'`, `'basic'`, `'pro'`, `'enterprise'`, `'custom'`
5. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**
1. –ó–∞–π–¥–∏—Ç–µ –≤ **Supabase SQL Editor**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `FIX_PLAN_CONSTRAINT.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```sql
-- Constraint —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω
CHECK (plan IN ('demo', 'basic', 'pro', 'enterprise', 'custom'))

-- –í—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è plan
demo        | 5
basic       | 10
pro         | 3
enterprise  | 1
custom      | 2
```

---

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

#### `src/lib/subscription-plans.ts`

**–ë—ã–ª–æ:**
```typescript
export type PlanKey = 'demo' | 'basic' | 'professional' | 'corporate' | 'custom'

// ...

{
  key: 'professional',
  // ...
},
{
  key: 'corporate',
  // ...
}
```

**–°—Ç–∞–ª–æ:**
```typescript
export type PlanKey = 'demo' | 'basic' | 'pro' | 'enterprise' | 'custom'

// ...

{
  key: 'pro',
  // ...
},
{
  key: 'enterprise',
  // ...
}
```

**–ü–æ—á–µ–º—É:**
- –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —Å —Ç–µ–º —á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ë–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∫–æ–¥—É (–≤ `UserProfileSheet.tsx` —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è 'pro')

---

## –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è plan

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ø–æ–ª–µ `plan` —Ä–∞–∑—Ä–µ—à–µ–Ω—ã **—Ç–æ–ª—å–∫–æ** —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

| –ó–Ω–∞—á–µ–Ω–∏–µ     | –ù–∞–∑–≤–∞–Ω–∏–µ (—Ä—É—Å—Å–∫–∏–π)      | –ù–∞–∑–≤–∞–Ω–∏–µ (–∏–≤—Ä–∏—Ç) |
|--------------|-------------------------|------------------|
| `demo`       | –î–µ–º–æ                    | ◊ì◊û◊ï              |
| `basic`      | –ë–∞–∑–æ–≤—ã–π                 | ◊ë◊°◊ô◊°◊ô            |
| `pro`        | –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π        | ◊û◊ß◊¶◊ï◊¢◊ô           |
| `enterprise` | –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π           | ◊ê◊®◊í◊ï◊†◊ô           |
| `custom`     | –ö–∞—Å—Ç–æ–º                  | ◊û◊ï◊™◊ê◊ù ◊ê◊ô◊©◊ô◊™      |

---

## –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–ª–∞–Ω—ã –≤ –∫–æ–¥–µ

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–æ–≤
**–§–∞–π–ª:** `src/lib/subscription-plans.ts`
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ `PlanKey`
- –ú–∞—Å—Å–∏–≤ `PLANS` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞–Ω–∞
- –§—É–Ω–∫—Ü–∏—è `getPlan()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–ª–∞–Ω–∞ –ø–æ –∫–ª—é—á—É

### 2. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–¥–ø–∏—Å–æ–∫
**–§–∞–π–ª:** `src/app/admin/subscriptions/page.tsx`
- –í—ã–±–æ—Ä –ø–ª–∞–Ω–∞ –≤ –º–æ–¥–∞–ª–∫–µ "–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞"
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–ª–∞–Ω–∞–º–∏

### 3. –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–§–∞–π–ª:** `src/components/user/UserProfileSheet.tsx`
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- Badge —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø–ª–∞–Ω–∞

### 4. Demo mode
**–§–∞–π–ª:** `src/hooks/useDemoMode.ts`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `plan === 'demo'` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è demo —Ä–µ–∂–∏–º–∞

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ constraint –≤ Supabase

```sql
SELECT 
    conname as constraint_name,
    pg_get_constraintdef(oid) as definition
FROM pg_constraint
WHERE conrelid = 'organizations'::regclass
  AND contype = 'c'
  AND conname = 'organizations_plan_check';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
constraint_name            | definition
---------------------------+----------------------------------------------------------
organizations_plan_check   | CHECK (plan IN ('demo', 'basic', 'pro', 'enterprise', 'custom'))
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è plan –≤ –±–∞–∑–µ

```sql
SELECT DISTINCT plan, COUNT(*) as count
FROM organizations
GROUP BY plan
ORDER BY plan;
```

**–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** `'professional'`, `'corporate'`, –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### 3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å custom –ø–ª–∞–Ω

1. –ó–∞–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ü–æ–¥–ø–∏—Å–∫–∏
2. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–¥–ª–∏—Ç—å" –Ω–∞ –ª—é–±–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω "–ö–∞—Å—Ç–æ–º" (Custom)
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–¥—É–ª–∏
5. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ "–î–æ—Å—Ç—É–ø –ø—Ä–æ–¥–ª—ë–Ω"

---

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `'custom'` –≤ constraint
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –ø–ª–∞–Ω—ã: `'professional'` ‚Üí `'pro'`, `'corporate'` ‚Üí `'enterprise'`
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω —Ç–∏–ø `PlanKey` –≤ TypeScript
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–æ–≤ –≤ `PLANS`
- ‚úÖ SQL –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## –°—Ç–∞—Ç—É—Å

- ‚úÖ SQL –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: `FIX_PLAN_CONSTRAINT.sql`
- ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω: `src/lib/subscription-plans.ts`
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: `FIX_PLAN_CONSTRAINT_DOCS.md`
- üîÑ **–ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:** –ó–∞–ø—É—Å—Ç–∏—Ç—å SQL –≤ Supabase
- üöÄ –ö–æ–¥ –∑–∞–ø—É—à–µ–Ω –≤ main, Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-26
