# üß† CLAUDE.md - Trinity Project Memory

**–§–∞–π–ª-–ø–∞–º—è—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤**  
**Powered by Amber Solutions Systems**

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã. –ü—Ä–æ—á–∏—Ç–∞–≤ —Ç–æ–ª—å–∫–æ –µ–≥–æ, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å –Ω—É–ª—è.

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-10 16:30 UTC  
**–í–µ—Ä—Å–∏—è:** 2.5.0

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.5.0 (2026-02-10 16:30) - CRITICAL FIX

### üêõ Critical Fix: CRM Dashboard Shows "Not Connected"

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- CRM Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "◊ú◊ê ◊û◊ó◊ï◊ë◊® ◊ú◊û◊¢◊®◊õ◊™" (–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–æ–∑—Ä–µ–≤–∞–ª —á—Ç–æ –∫–æ–¥ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `profiles`

**–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `from('profiles')` - –ù–ï –ù–ê–ô–î–ï–ù–û
- ‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É profiles
- ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ —Ç–∞–±–ª–∏—Ü–µ profiles

**–ù–∞—Å—Ç–æ—è—â–∞—è Root Cause:**

1. **DashboardLayout –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª —Ä–µ–Ω–¥–µ—Ä:**
```typescript
// ‚ùå –ë–´–õ–û
if (isLoading) {
  return <Spinner />  // –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
}
```
- –ü–æ–∫–∞–∑—ã–≤–∞–ª spinner –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–µ–ª –∫–æ–Ω—Ç–µ–Ω—Ç
- Middleware —É–∂–µ –∑–∞—â–∏—â–∞–µ—Ç routes - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω—É–∂–Ω–æ

2. **UserProfileSheet –ø–æ–∫–∞–∑—ã–≤–∞–ª "Not Connected" —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ:**
```typescript
// ‚ùå –ë–´–õ–û
{!authLoading && user ? (
  <Profile />
) : (
  <NotConnected />
)}
```
- –ù–µ –∂–¥–∞–ª –∑–∞–≥—Ä—É–∑–∫—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–ª –æ—à–∏–±–∫—É –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –≥—Ä—É–∑–∏–ª–∏—Å—å

3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:**
- –ù–µ –≤–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
- –ù–µ—Ç timestamp'–æ–≤
- –°–ª–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å timing issues

**–†–µ—à–µ–Ω–∏–µ:**

1. **Dashboard Layout - –£–±—Ä–∞–Ω Loading Block:**
```typescript
// ‚úÖ –°–¢–ê–õ–û
// Don't block rendering - middleware already protects routes
return (
  <div>
    {/* Content renders immediately */}
  </div>
)
```

2. **UserProfileSheet - –ñ–¥—ë—Ç –æ–±–∞ loading:**
```typescript
// ‚úÖ –°–¢–ê–õ–û
{authLoading || orgLoading ? (
  <Spinner text={authLoading ? '◊ò◊ï◊¢◊ü ◊§◊®◊ï◊§◊ô◊ú...' : '◊ò◊ï◊¢◊ü ◊ê◊®◊í◊ï◊ü...'} />
) : user ? (
  <Profile />
) : (
  <NotConnected />
)}
```

3. **useAuth - Enhanced Debug:**
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω—ã:
- Timestamp –¥–ª—è –∫–∞–∂–¥–æ–≥–æ loadAuth
- Performance timing (ms –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
- Total time measurement
- –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- State reset –Ω–∞ exception
```

**Debug Logs:**
```
[useAuth] ========== START loadAuth ==========
[useAuth] Timestamp: 2026-02-10T16:30:00.000Z
[useAuth] GetUser completed in 45 ms
[useAuth] Checking admin status...
[useAuth] Admin check completed in 23 ms
[useAuth] Checking org_users...
[useAuth] Org check completed in 18 ms
[useAuth] Total time: 86 ms
[useAuth] ========== END loadAuth ==========
[UserProfileSheet] Opened with state: {hasUser: true, orgId: "..."}
```

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `src/app/(dashboard)/layout.tsx` - —É–±—Ä–∞–Ω loading block
- ‚úÖ `src/components/user/UserProfileSheet.tsx` - –∂–¥—ë—Ç org loading
- ‚úÖ `src/hooks/useAuth.ts` - enhanced timing debug

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å—Ä–∞–∑—É (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è)
- ‚úÖ Middleware –≤—Å—ë –µ—â—ë –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç unauthorized
- ‚úÖ –í–∏–¥–∏–º–æ—Å—Ç—å —Ç–æ—á–Ω–æ–≥–æ timing –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ UserProfileSheet –∂–¥—ë—Ç –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–µ—Å—å auth flow

**–í–ê–ñ–ù–û:** –¢–∞–±–ª–∏—Ü–∞ `profiles` –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ —Ä–∞–Ω–µ–µ –∏ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç `org_users` —Å `user_id` Foreign Key.

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.9 (2026-02-10 15:50) - CRITICAL FIX

### üêõ Critical Fix: Auth Not Loading When Navigating From Admin to CRM

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∞–¥–º–∏–Ω–∫—É (—Ä–∞–±–æ—Ç–∞–µ—Ç)
- –ù–∞–∂–∏–º–∞–µ—Ç "◊ó◊ñ◊®◊î ◊ú◊û◊¢◊®◊õ◊™" ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ CRM
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "◊ú◊ê ◊û◊ó◊ï◊ë◊® ◊ú◊û◊¢◊®◊õ◊™ ◊ê◊†◊ê ◊î◊™◊ó◊ë◊® ◊û◊ó◊ì◊©" (–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
- useAuth() –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ navigation

**Root Cause:**
- useAuth() –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ initial mount
- Client-side navigation –∏–∑ /admin –≤ / –Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç refetch
- React hooks –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ routing
- onAuthStateChange –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–ª—è —Ç–æ–π –∂–µ session

**–†–µ—à–µ–Ω–∏–µ:**

1. **useAuth() - Pathname Monitoring:**
```typescript
import { usePathname } from 'next/navigation'

const pathname = usePathname()

useEffect(() => {
  console.log('[useAuth] Pathname changed:', pathname)
  if (!isLoading) {
    loadAuth()  // Refetch on every route change!
  }
}, [pathname])
```

2. **Dashboard Layout - Unconditional Refetch:**
```typescript
useEffect(() => {
  // ALWAYS refetch on mount (critical for /admin ‚Üí / navigation)
  refetch()
}, [])
```

3. **UserProfileSheet - Better Loading Check:**
```typescript
// Don't show "not connected" while loading
{!authLoading && user ? (
  <Profile />
) : (
  <NotConnected />
)}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ `src/hooks/useAuth.ts` - —Å–ª–µ–¥–∏—Ç –∑–∞ pathname, refetch –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- ‚úÖ `src/app/(dashboard)/layout.tsx` - –±–µ–∑—É—Å–ª–æ–≤–Ω—ã–π refetch –ø—Ä–∏ mount
- ‚úÖ `src/components/user/UserProfileSheet.tsx` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ loading

**Debug Logs:**
```
[useAuth] Pathname changed: /
[useAuth] Current state before refetch: { hasUser: false, orgId: null }
[useAuth] Triggering refetch due to pathname change...
[useAuth] ========== START loadAuth ==========
[useAuth] ‚úÖ User found: { id: "...", email: "..." }
[useAuth] ‚úÖ Found org_id: ...
[DashboardLayout] ===== MOUNTED =====
[DashboardLayout] Forcing refetch on mount...
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Auth refetch –ø—Ä–∏ –∫–∞–∂–¥–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ User data –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
- ‚úÖ –ù–µ—Ç –ª–æ–∂–Ω—ã—Ö "not connected" —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ Session —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –õ–æ–≥–∏–Ω ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É
2. "◊ó◊ñ◊®◊î ◊ú◊û◊¢◊®◊õ◊™" ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ CRM
3. –°–º–æ—Ç—Ä–∏—Ç–µ console (F12) - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ refetch
4. –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
5. –ú–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.8 (2026-02-10 15:38)

### üêõ Fix: Logout on Navigation from Admin Panel

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è v2.4.7 –∫–Ω–æ–ø–∫–∞ "◊ó◊ñ◊®◊î ◊ú◊û◊¢◊®◊õ◊™" –≤—ã–∫–∏–¥—ã–≤–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ –≤–º–µ—Å—Ç–æ –≥–ª–∞–≤–Ω–æ–π.

**Root Cause:**
- `window.location.href` –¥–µ–ª–∞–ª full page reload
- Dashboard layout –ø—Ä–æ–≤–µ—Ä—è–ª auth —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ
- –†–µ–¥–∏—Ä–µ–∫—Ç–∏–ª –Ω–∞ /login –¥–æ —Ç–æ–≥–æ –∫–∞–∫ useAuth —É—Å–ø–µ–≤–∞–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
- –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ auth (middleware + layout) —Å–æ–∑–¥–∞–≤–∞–ª–∞ race condition

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–µ—Ä–Ω—É–ª `Link` –≤–º–µ—Å—Ç–æ `button` (client-side navigation, –±–µ–∑ full reload)
2. –£–±—Ä–∞–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login –∏–∑ dashboard layout
3. Middleware —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç auth - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω—É–∂–Ω–æ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ `src/app/(dashboard)/layout.tsx` - —É–±—Ä–∞–Ω login redirect
- ‚úÖ `src/components/layout/AdminSidebar.tsx` - –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ Link

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏–∑ –∞–¥–º–∏–Ω–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–µ—Ç logout –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
- ‚úÖ Auth –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Session —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–í–∞–∂–Ω–æ:** Middleware (`middleware.ts`) —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ. –ù–µ –Ω—É–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É –≤ layout - —ç—Ç–æ —Å–æ–∑–¥–∞—ë—Ç race conditions.

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.7 (2026-02-10 15:30) - CRITICAL FIX

### üêõ Critical Fix: Auth Not Loading When Navigating From Admin

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –≤ –∞–¥–º–∏–Ω–∫–µ
- –ù–∞–∂–∏–º–∞–µ—Ç "◊ó◊ñ◊®◊î ◊ú◊û◊¢◊®◊õ◊™" (–í–æ–∑–≤—Ä–∞—Ç –≤ —Å–∏—Å—Ç–µ–º—É)
- –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "◊ú◊ê ◊û◊ó◊ï◊ë◊® ◊ú◊û◊¢◊®◊õ◊™" (–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
- `user` –æ–±—ä–µ–∫—Ç `undefined`

**Root Cause:**
–ù–∞–≤–∏–≥–∞—Ü–∏—è –∏–∑ `/admin` –≤ `/` –Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏–ª–∞ reload auth:
- useAuth() state –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
- Session —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞, –Ω–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å
- onAuthStateChange –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ø—Ä–∏ client-side navigation

**–†–µ—à–µ–Ω–∏–µ:**

1. **Dashboard Layout (src/app/(dashboard)/layout.tsx):**
   ```typescript
   // Added auth guard on mount
   useEffect(() => {
     if (!isLoading && !user) {
       refetch()  // Force reload
     }
   }, [])
   
   // Redirect if no user after loading
   if (!isLoading && !user) {
     router.push('/login')
   }
   
   // Show loading state
   if (isLoading) {
     return <LoadingSpinner />
   }
   ```

2. **useAuth() Hook:**
   ```typescript
   // Enhanced onAuthStateChange listener
   supabase.auth.onAuthStateChange((event, session) => {
     if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
       loadAuth()  // Reload on these events
     }
     // More verbose logging
   })
   ```

3. **Admin Sidebar:**
   ```typescript
   // Changed from Link to button
   <button onClick={() => {
     window.location.href = '/'  // Full page reload
   }}>
     ◊ó◊ñ◊®◊î ◊ú◊û◊¢◊®◊õ◊™
   </button>
   ```

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `src/app/(dashboard)/layout.tsx` - auth guard + refetch
- ‚úÖ `src/hooks/useAuth.ts` - better auth state change handling
- ‚úÖ `src/components/layout/AdminSidebar.tsx` - force reload

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Auth –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
- ‚úÖ User session —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- ‚úÖ –ù–µ—Ç "–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω" –ø–æ—Å–ª–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ Debug logs –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–µ—Å—å auth flow

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –ó–∞–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É: `/admin`
2. –ù–∞–∂–º–∏—Ç–µ "◊ó◊ñ◊®◊î ◊ú◊û◊¢◊®◊õ◊™"
3. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∫–∏
4. –ó–∞—Ç–µ–º –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –≤–∞—à–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ auth

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.6 (2026-02-10 15:22)

### ‚ú® –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + Enhanced Debug

**–ü—Ä–æ–±–ª–µ–º–∞:** 
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª "User ID: ◊ú◊ê ◊ñ◊û◊ô◊ü" –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç `user?.id === undefined`.

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç UserProfileSheet –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã + –ø–æ–¥—Ä–æ–±–Ω–æ–µ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

1. **UserProfileSheet –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**
   - –ü—Ä–æ—Ñ–∏–ª—å –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ –∞–¥–º–∏–Ω–æ–≤)
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: –∏–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
   - **Debug —Å–µ–∫—Ü–∏—è** —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
     - User ID
     - Org ID
     - Auth Status
     - Is Admin
   - –ö–Ω–æ–ø–∫–∞ "◊®◊¢◊†◊ü ◊†◊™◊ï◊†◊ô◊ù" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ refetch
   - –ö—Ä–∞—Å–∏–≤—ã–π gradient –¥–∏–∑–∞–π–Ω
   - Side: left (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ª–µ–≤–∞)

2. **–û–±–Ω–æ–≤–ª—ë–Ω Sidebar:**
   - –ë–ª–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è —Ç–µ–ø–µ—Ä—å **–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π**
   - Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏
   - –ò–∫–æ–Ω–∫–∞ ChevronLeft –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–µ
   - –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è UserProfileSheet
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

3. **Enhanced Debug –≤ useAuth():**
   ```typescript
   console.log('[useAuth] ========== START loadAuth ==========')
   console.log('[useAuth] Calling supabase.auth.getUser()...')
   console.log('[useAuth] GetUser result:', { user, error })
   console.log('[useAuth] ‚úÖ User found:', { id, email, phone })
   console.log('[useAuth] Checking admin status for user_id:', user.id)
   console.log('[useAuth] Admin check result:', '‚úÖ IS ADMIN' / '‚ùå NOT ADMIN')
   console.log('[useAuth] Checking org_users for user_id:', user.id)
   console.log('[useAuth] Org check result:', '‚úÖ Found org_id' / '‚ùå NO ORG')
   console.log('[useAuth] Final state:', { isAdmin, orgId })
   console.log('[useAuth] ========== END loadAuth ==========')
   ```

**Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–º–æ–≥–∞–µ—Ç:**
- ‚úÖ –í–∏–¥–µ—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ auth
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–¥–µ –∏–º–µ–Ω–Ω–æ –æ—à–∏–±–∫–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- ‚úÖ –ü–æ–Ω—è—Ç—å –ø–æ—á–µ–º—É user undefined

**–§–∞–π–ª—ã:**
- ‚úÖ `src/components/user/UserProfileSheet.tsx` - –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- ‚úÖ `src/components/layout/Sidebar.tsx` - –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
- ‚úÖ `src/hooks/useAuth.ts` - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–µ –∞–¥–º–∏–Ω–∫—É)
2. –í–Ω–∏–∑—É sidebar –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ –∏–º—è/email
3. –û—Ç–∫—Ä–æ–µ—Ç—Å—è Sheet —Å–ª–µ–≤–∞ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–µ–∫—Ü–∏—é "◊û◊ô◊ì◊¢ ◊ò◊õ◊†◊ô (Debug)"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ console logs (F12)

**Debug —Å–µ–∫—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- User ID: `b9344b8c-7ccd-...` –∏–ª–∏ `‚ùå ◊ú◊ê ◊ñ◊û◊ô◊ü`
- Org ID: `a0eebc99-9c0b-...` –∏–ª–∏ `‚ùå ◊ú◊ê ◊ñ◊û◊ô◊ü`
- Auth Status: `‚úÖ ◊û◊ó◊ï◊ë◊®` –∏–ª–∏ `‚ùå ◊ú◊ê ◊û◊ó◊ï◊ë◊®`
- Is Admin: `‚úÖ ◊õ◊ü` ◊ê◊ï `‚ùå ◊ú◊ê`

**–ï—Å–ª–∏ User ID –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:**
- –°–º–æ—Ç—Ä–∏—Ç–µ console logs
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "◊®◊¢◊†◊ü ◊†◊™◊ï◊†◊ô◊ù"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.5 (2026-02-10 15:15) - CRITICAL FIX

### üêõ Critical Fix: useAuth() Static Cache Bug

**–ü—Ä–æ–±–ª–µ–º–∞:** 
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–≥ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤, —Ö–æ—Ç—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è. –°–æ–æ–±—â–µ–Ω–∏–µ: "◊ú◊ê ◊†◊û◊¶◊ê ◊ê◊®◊í◊ï◊ü ◊ú◊û◊©◊™◊û◊©"

**Root Cause:**
```typescript
// ‚ùå –ë–´–õ–û - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
let cachedOrgId: string | null = null

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π:
if (cachedOrgId !== null || cachedIsAdmin !== null) {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä—ã–π –∫—ç—à, –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ë–î!
  return
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–æ–≥–¥–∞ `cachedOrgId = null` (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ null), —É—Å–ª–æ–≤–∏–µ `!== null` –±—ã–ª–æ `false`
- –ù–û `cachedOrgId = null` –æ–∑–Ω–∞—á–∞–ª–æ "—É–∂–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–æ" (–Ω–µ undefined)
- –ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–ª –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `null` –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ë–î
- Logout/login –Ω–µ –ø–æ–º–æ–≥–∞–ª, —Ç.–∫. –∫—ç—à –≤ –ø–∞–º—è—Ç–∏ –æ—Å—Ç–∞–≤–∞–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚úÖ –°–¢–ê–õ–û - —É–±—Ä–∞–Ω —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à –ø–æ–ª–Ω–æ—Å—Ç—å—é
export function useAuth() {
  const [orgId, setOrgId] = useState<string | null>(null)
  
  const loadAuth = async () => {
    // –í—Å–µ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
    const { data: orgRow } = await supabase
      .from('org_users')
      .select('org_id')
      .eq('user_id', user.id)
      .maybeSingle()
    
    setOrgId(orgRow?.org_id ?? null)
  }
  
  // –°–ª—É—à–∞–µ–º auth state changes
  supabase.auth.onAuthStateChange(() => {
    loadAuth()  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refetch
  })
}
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. **useAuth.ts:**
   - ‚úÖ –£–±—Ä–∞–Ω –≤–µ—Å—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à (`cachedOrgId`, `cachedIsAdmin`)
   - ‚úÖ –î–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –≤ React state (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `onAuthStateChange` listener –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `refetch()` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã console.log –¥–ª—è debug

2. **AddClientDialog.tsx:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω debug console.log –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
   - ‚úÖ –£–ª—É—á—à–µ–Ω warning –±–ª–æ–∫ —Å User ID
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "◊®◊¢◊†◊ü ◊†◊™◊ï◊†◊ô◊ù" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ refetch
   - ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ

3. **CHECK_CURRENT_USER.sql:**
   - ‚úÖ –°–æ–∑–¥–∞–Ω –±—ã—Å—Ç—Ä—ã–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, –∞–¥–º–∏–Ω —Å—Ç–∞—Ç—É—Å
   - ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
- üîÑ –í—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
- üéØ React state –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- üîä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ auth changes
- üîß –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ refetch
- üêõ Debug –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
1. –û—Ç–∫—Ä–æ–π—Ç–µ Developer Console (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–æ–≤
3. –û—Ç–∫—Ä–æ–π—Ç–µ "◊î◊ï◊°◊£ ◊ú◊ß◊ï◊ó ◊ó◊ì◊©"
4. –°–º–æ—Ç—Ä–∏—Ç–µ console logs:
   [useAuth] Loading auth for user: <uuid>
   [useAuth] Is admin: true/false
   [useAuth] Org ID: <uuid or null>
   [AddClientDialog] Dialog opened
   [AddClientDialog] OrgId: <uuid>
```

**–§–∞–π–ª—ã:**
- ‚úÖ `src/hooks/useAuth.ts` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω
- ‚úÖ `src/components/clients/AddClientDialog.tsx` - debug + refetch –∫–Ω–æ–ø–∫–∞
- ‚úÖ `supabase/CHECK_CURRENT_USER.sql` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ orgId –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è –Ω–∞ —Å—Ç–∞—Ä–æ–º –∫—ç—à–µ
- ‚úÖ Logout/login –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.4 (2026-02-10 15:05)

### ‚ú® –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∞ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä—è–º–æ –∏–∑ sidebar.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

1. **AdminProfileSheet –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**
   - –ö—Ä–∞—Å–∏–≤—ã–π Sheet —Å–ø—Ä–∞–≤–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ —Å –ø–µ—Ä–≤–æ–π –±—É–∫–≤–æ–π –∏–º–µ–Ω–∏
   - Badge —Å —Ä–æ–ª—å—é (admin/moderator)
   - Readonly –ø–æ–ª—è: email, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
   - Editable –ø–æ–ª—è: –ø–æ–ª–Ω–æ–µ –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

2. **API Route `/api/admin/profile`:**
   - `GET` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å –¥–∞–Ω–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
   - `PATCH` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ organization info —á–µ—Ä–µ–∑ org_users
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ phone –≤ auth.users metadata

3. **–û–±–Ω–æ–≤–ª—ë–Ω AdminSidebar:**
   - –ë–ª–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è —Ç–µ–ø–µ—Ä—å **–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–º–µ—Å—Ç–æ "Admin"
   - Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏
   - –ò–∫–æ–Ω–∫–∞ ChevronRight –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–µ
   - –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è AdminProfileSheet

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è:**
```typescript
{
  email: string              // readonly
  full_name: string | null   // editable
  role: 'admin' | 'moderator' // readonly
  phone: string              // editable
  organization: {            // readonly
    id: string
    name: string
    role: string
  } | null
}
```

**UI Features:**
- üé® –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ React Query
- ‚úÖ Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- üì± Responsive design
- üåô Dark mode support
- ‚å®Ô∏è Accessibility (labels, keyboard navigation)

**–§–∞–π–ª—ã:**
- ‚úÖ `src/components/admin/AdminProfileSheet.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ `src/app/api/admin/profile/route.ts` - API endpoint
- ‚úÖ `src/components/layout/AdminSidebar.tsx` - –æ–±–Ω–æ–≤–ª—ë–Ω

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω
2. –í–Ω–∏–∑—É sidebar –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ –∏–º—è/email
3. –û—Ç–∫—Ä–æ–µ—Ç—Å—è Sheet —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
4. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω
5. –ù–∞–∂–º–∏—Ç–µ "◊©◊û◊ï◊® ◊©◊ô◊†◊ï◊ô◊ô◊ù"
6. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –∏ –æ–±–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.3 (2026-02-10 14:50) - CRITICAL

### üö® Critical Fix: Auth Callback Redirects to Localhost in Production

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –Ω–∞ Vercel (production) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `http://localhost:3001`, —á—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–º–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

**Root Cause:**
```typescript
// ‚ùå –ë–´–õ–û - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ env variable –∏–ª–∏ fallback
const baseUrl = process.env.NEXT_PUBLIC_APP_URL || url.origin
return NextResponse.redirect(new URL('/admin', baseUrl))
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- `NEXT_PUBLIC_APP_URL` –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ localhost –ª–æ–∫–∞–ª—å–Ω–æ
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ Vercel
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä–∞–∑–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è–º
- –ü—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ä–µ–¥–∏—Ä–µ–∫—Ç—É –Ω–∞ localhost –≤ production

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚úÖ –°–¢–ê–õ–û - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ origin
const origin = request.nextUrl.origin
return NextResponse.redirect(`${origin}/admin`)
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. **src/app/callback/route.ts:**
   - ‚úÖ –ó–∞–º–µ–Ω–∏–ª `process.env.NEXT_PUBLIC_APP_URL` –Ω–∞ `request.nextUrl.origin`
   - ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π origin —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ localhost –ò production
   - ‚úÖ –ó–∞–º–µ–Ω–∏–ª email-based queries –Ω–∞ user_id (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å v2.4.1-2.4.2)
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–∏–ø `NextRequest` –¥–ª—è –ª—É—á—à–µ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
   - ‚úÖ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ `searchParams`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üöÄ –†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –ª—é–±–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- üîß –ù–µ –Ω—É–∂–Ω—ã environment variables –¥–ª—è URL
- ‚úÖ Localhost: `http://localhost:3001`
- ‚úÖ Vercel: `https://trinity-sage.vercel.app`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –õ–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost
- ‚úÖ –õ–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Vercel production
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–∞ localhost –≤ production
- ‚úÖ Environment variable `NEXT_PUBLIC_APP_URL` –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# Production (Vercel)
1. Login ‚Üí https://trinity-sage.vercel.app
2. Auth callback redirects to https://trinity-sage.vercel.app/admin ‚úÖ
3. NO redirect to localhost ‚úÖ
```

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ `docs/FIX_AUTH_REDIRECT_LOCALHOST.md` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**Priority:** CRITICAL - Production blocker –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.2 (2026-02-10 14:10)

### üêõ Critical Fix: Removed Email-Based Queries (500 Error Fix)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–¥–∞–≤–∞–ª–æ 500 –æ—à–∏–±–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ orgId, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ "Missing orgId 0"

**–î–∏–∞–≥–Ω–æ–∑:**
- –ö–æ–¥ –ø—ã—Ç–∞–ª—Å—è –ø–æ–ª—É—á–∏—Ç—å org_id –ø–æ email –≤–º–µ—Å—Ç–æ user_id
- –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ **3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö**: middleware, api-auth, useAuth
- Email-based –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Foreign Key –∏ –Ω–µ–Ω–∞–¥—ë–∂–Ω—ã
- –ü—Ä–∏–≤–æ–¥–∏–ª–æ –∫ 500 –æ—à–∏–±–∫–µ ‚Üí orgId = 0 ‚Üí –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **middleware.ts:**
   - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–æ: `.eq('email', email)` ‚Üí `.eq('user_id', user.id)`
   - ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –¥–ª—è admin_users –∏ org_users
   - ‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FK relationship –ø—Ä–∞–≤–∏–ª—å–Ω–æ

2. **src/lib/api-auth.ts:**
   - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–æ: `.ilike('email', email)` ‚Üí `.eq('user_id', user.id)`
   - ‚úÖ –£–±—Ä–∞–Ω case-insensitive –ø–æ–∏—Å–∫ –ø–æ email
   - ‚úÖ –ü—Ä—è–º–æ–π lookup –ø–æ user_id (FK)
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö API routes

3. **src/hooks/useAuth.ts:**
   - ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ v2.4.1

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω:**
```typescript
// ‚úÖ CORRECT - Query by Foreign Key
const { data } = await supabase
  .from('org_users')
  .select('org_id')
  .eq('user_id', user.id)  // <-- FK to auth.users(id)
  .maybeSingle()

// ‚ùå WRONG - Query by email (not FK)
const { data } = await supabase
  .from('org_users')
  .select('org_id')
  .eq('email', user.email)  // <-- Unreliable!
  .maybeSingle()
```

**Impact:**
- ‚úÖ Middleware - auth checks –Ω–∞ –∫–∞–∂–¥–æ–º request
- ‚úÖ API Routes - –≤—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ endpoints
- ‚úÖ Client-side hooks - user context

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ `docs/FIX_PROFILES_TABLE_REMOVED.md` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ fix

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```sql
-- Verify user has org_users record with user_id
SELECT user_id, org_id, email 
FROM org_users 
WHERE user_id = auth.uid();
```

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.1 (2026-02-10 13:30)

### üêõ Critical Bug Fix: "Missing orgId 0" Error

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–¥–∞–≤–∞–ª–∞ –æ—à–∏–±–∫—É "Missing orgId 0"

**–ü—Ä–∏—á–∏–Ω–∞:** 
- `useAuth()` hook –∏—Å–∫–∞–ª org_id –ø–æ email –≤–º–µ—Å—Ç–æ user_id
- –ó–∞–ø—Ä–æ—Å `org_users` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `.eq('email', user.email)` –≤–º–µ—Å—Ç–æ `.eq('user_id', user.id)`
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ orgId –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª—Å—è –∫–∞–∫ null –∏–ª–∏ '0'

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **src/hooks/useAuth.ts:**
   - ‚úÖ –ò–∑–º–µ–Ω—ë–Ω –∑–∞–ø—Ä–æ—Å: `.eq('email', user.email)` ‚Üí `.eq('user_id', user.id)`
   - ‚úÖ –¢–µ–ø–µ—Ä—å –∏—â–µ–º –ø–æ FK user_id, —á—Ç–æ –Ω–∞–¥—ë–∂–Ω–µ–µ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ
   - ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫–∞–∫ –¥–ª—è org_users, —Ç–∞–∫ –∏ –¥–ª—è admin_users

2. **src/hooks/useClients.ts:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ isLoading –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º mutation
   - ‚úÖ –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ –∏–≤—Ä–∏—Ç–µ
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω console.log –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `!orgId || orgId === '0'`

3. **src/components/clients/AddClientDialog.tsx:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω useAuth() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ orgId
   - ‚úÖ Warning —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ orgId –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" disabled –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è auth
   - ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "◊ò◊ï◊¢◊ü..." –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ `docs/FIX_MISSING_ORGID.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–∞–≥–∞ –∏ fix
- ‚úÖ `supabase/fix-org-users-data.sql` ‚Äî SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ user_id —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ org_users:
SELECT user_id, email FROM org_users WHERE user_id = auth.uid();

-- Auto-fix –µ—Å–ª–∏ user_id = NULL:
UPDATE org_users SET user_id = au.id 
FROM auth.users au 
WHERE org_users.email = au.email AND org_users.user_id IS NULL;
```

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.4.0 (2026-02-09 22:00)

### üéâ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–≤ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞

**1. –†–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `role` –≤ —Ç–∞–±–ª–∏—Ü—É `admin_users` (admin/moderator)
- ‚úÖ **Admin** ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É (–∫–∞–∫ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω)
- ‚úÖ **Moderator** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø (–ø—Ä–æ—Å–º–æ—Ç—Ä, –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è)

**2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç AssignAdminDialog**
- –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–±–æ—Ä —Ä–æ–ª–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏ Shield (admin) –∏ Users (moderator)
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏ –Ω–∞ –∏–≤—Ä–∏—Ç–µ
- –°—Ç–∏–ª–∏: admin (—Å–∏–Ω–∏–π), moderator (—è–Ω—Ç–∞—Ä–Ω—ã–π)

**3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ ClientSheet**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "◊û◊†◊î ◊õ◊û◊†◊î◊ú" (—è–Ω—Ç–∞—Ä–Ω–∞—è) –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ù–ï –∞–¥–º–∏–Ω
- ‚úÖ Badge "◊û◊†◊î◊ú ◊û◊¢◊®◊õ◊™" –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∞–¥–º–∏–Ω
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "◊î◊°◊® ◊î◊®◊©◊ê◊ï◊™" (–∫—Ä–∞—Å–Ω–∞—è) –¥–ª—è —Å–Ω—è—Ç–∏—è –ø–æ–ª–Ω–æ–º–æ—á–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ email: –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—à–∏–±–∫–∞ "◊ú◊ê ◊†◊ô◊™◊ü ◊ú◊û◊†◊ï◊™ ◊ú◊ú◊ê ◊ê◊ô◊û◊ô◊ô◊ú"
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ auth.users —á–µ—Ä–µ–∑ org_users

**4. API Route /api/admin/assign**
- **POST** ‚Äî –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
  - –ü–æ–∏—Å–∫ user_id —á–µ—Ä–µ–∑ org_users (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω —Ö–æ—Ç—è –±—ã —Ä–∞–∑)
  - Insert/Update –≤ admin_users
  - –û—à–∏–±–∫–∞ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω: "◊î◊û◊©◊™◊û◊© ◊¶◊®◊ô◊ö ◊ú◊î◊ô◊õ◊†◊° ◊ú◊û◊¢◊®◊õ◊™ ◊ú◊§◊ó◊ï◊™ ◊§◊¢◊ù ◊ê◊ó◊™"
- **DELETE** ‚Äî —Å–Ω—è—Ç—å –ø–æ–ª–Ω–æ–º–æ—á–∏—è
  - –ó–∞—â–∏—Ç–∞: –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–µ–±—è
  - –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ admin_users

**5. –•—É–∫ useClientAdminStatus**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞ (isAdmin, role)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥
- Refetch –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**6. SQL –º–∏–≥—Ä–∞—Ü–∏—è**
- –§–∞–π–ª: `supabase/add-admin-roles.sql`
- –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É `role` —Å CHECK constraint (admin/moderator)
- DEFAULT 'admin' –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.3.1 (2026-02-09 20:50-20:55)

### üéâ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

**1. –ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∞ –≤ Sidebar**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `full_name` –≤ —Ç–∞–±–ª–∏—Ü—É `admin_users`
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ö—É–∫ `useAdminProfile()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∞
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `AdminSidebar`:
  - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è **–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∫—Ä—É–ø–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º
  - –ü–æ–¥ –Ω–∏–º **email** –º–µ–ª–∫–∏–º —à—Ä–∏—Ñ—Ç–æ–º (text-slate-400)
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ ("◊ò◊ï◊¢◊ü...")
- ‚úÖ SQL –º–∏–≥—Ä–∞—Ü–∏—è: `supabase/add-admin-name.sql`
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.3 (2026-02-09 19:00-20:45)

### üéâ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

**1. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π RTL Layout**
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:** main ‚Üí sidebar (sidebar –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ø—Ä–∞–≤–∞ –≤ RTL)
- ‚úÖ **–£–±—Ä–∞–Ω `flex-row-reverse`** ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, RTL —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ
- ‚úÖ **Sidebar sticky:** –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ **–ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ** —Å–ª–µ–≤–∞ –æ—Ç sidebar
- ‚úÖ **Desktop layout:** `lg:flex` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞** `lg:flex-row-h-screen` ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ layout:**
```tsx
<div className="min-h-screen">
  <MobileHeader /> {/* –¢–æ–ª—å–∫–æ <1024px */}
  <div className="lg:flex lg:h-screen">
    <main className="flex-1 overflow-y-auto"> {/* –ö–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è */}
      {children}
    </main>
    <aside className="hidden lg:block lg:w-64 sticky top-0 h-screen"> {/* Sidebar —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω */}
      <Sidebar />
    </aside>
  </div>
</div>
```

**2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Sidebar**
- –ò–∑–º–µ–Ω—ë–Ω —Ç–µ–≥: `<aside>` ‚Üí `<div>` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ flow
- –£–±—Ä–∞–Ω `h-screen` –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è layout)
- –î–æ–±–∞–≤–ª–µ–Ω `h-full` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫: `Sidebar.tsx`, `AdminSidebar.tsx`

**3. Dark mode —É–ª—É—á—à–µ–Ω–∏—è**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ü–≤–µ—Ç–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ
- –î–æ–±–∞–≤–ª–µ–Ω—ã `dark:` –∫–ª–∞—Å—Å—ã –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.2 (2026-02-09 18:00-19:00)

### üéâ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

**1. –ü—Ä–æ–≤–µ—Ä–∫–∞ features –≤ API routes**
- –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `src/lib/api-auth.ts` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ features
- –§—É–Ω–∫—Ü–∏–∏: `checkAuth()`, `checkFeature()`, `checkAuthAndFeature()`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `features.payments` –≤ `/api/payments/create-link`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `features.sms` –≤ `/api/sms/campaign` –∏ `/api/sms/send`
- –ü—Ä–∏ –æ—Ç–∫–ª—é—á—ë–Ω–Ω–æ–π —Ñ–∏—á–µ ‚Üí –æ—à–∏–±–∫–∞ 403 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "◊î◊§◊ô◊¶'◊® ◊ú◊ê ◊ñ◊û◊ô◊ü ◊ë◊™◊ï◊õ◊†◊ô◊™ ◊©◊ú◊ö"
- –ó–∞—â–∏—Ç–∞ –Ω–∞ 3 —É—Ä–æ–≤–Ω—è—Ö: middleware, UI, API routes

**2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞**
- –ö—Ä–∞—Å–∏–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω (blue-50 ‚Üí indigo-50 ‚Üí slate-100)
- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫—Ä—É–≥–∏ —Å —Ä–∞–∑–º—ã—Ç–∏–µ–º (blur-3xl)
- –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ (backdrop-blur-xl)
- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Å–ø–∏–Ω–Ω–µ—Ä–æ–º
- –§—É—Ç–µ—Ä —Å –∏–∫–æ–Ω–∫–∞–º–∏ (üîí ◊ó◊ô◊ë◊ï◊® ◊û◊ê◊ï◊ë◊ò◊ó ‚Ä¢ üáÆüá± ◊™◊û◊ô◊õ◊î ◊ë◊¢◊ë◊®◊ô◊™)

**3. –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é (–æ—Å–Ω–æ–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)**
- `MobileHeader` ‚Äî –±—É—Ä–≥–µ—Ä + –∫–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥" (—Ç–æ–ª—å–∫–æ <1024px)
- `MobileSidebar` ‚Äî –≤—ã–¥–≤–∏–∂–Ω–æ–µ –º–µ–Ω—é —Å–ø—Ä–∞–≤–∞ (Sheet)
- –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã, –∞–Ω–∏–º–∞—Ü–∏–∏, hover —ç—Ñ—Ñ–µ–∫—Ç—ã
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–º –∞–≤–∞—Ç–∞—Ä–æ–º
- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
- –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–µ—Å–ª–∏ –∞–¥–º–∏–Ω)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—É–Ω–∫—Ç–∞

**4. –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)**
- `MobileAdminHeader` ‚Äî –±—É—Ä–≥–µ—Ä + –∫–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥" –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ
- `MobileAdminSidebar` ‚Äî –≤—ã–¥–≤–∏–∂–Ω–æ–µ –º–µ–Ω—é –≤ —Ç—ë–º–Ω—ã—Ö —Ç–æ–Ω–∞—Ö
- –ì—Ä–∞–¥–∏–µ–Ω—Ç slate-800 ‚Üí slate-900
- –ö–Ω–æ–ø–∫–∞ "◊ó◊ñ◊®◊î ◊ú◊û◊¢◊®◊õ◊™" —Å –∑–µ–ª—ë–Ω—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º
- –ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º purple-500 ‚Üí pink-600

**5. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (Dark/Light)**
- –î–æ–±–∞–≤–ª–µ–Ω –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö: Sidebar, MobileSidebar, AdminSidebar, MobileAdminSidebar
- –ò–∫–æ–Ω–∫–∏ Moon/Sun –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- localStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ

---

## ‚ö° –û–ë–ù–û–í–õ–ï–ù–ò–Ø v2.1 (2026-02-09 00:00-18:00)

### üéâ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

**1. –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—á–∞–º–∏**
- –•—É–∫ `useFeatures()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –•—É–∫ `useOrganization()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –°–∫—Ä—ã—Ç–∏–µ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ `features.sms`, `features.payments`, `features.analytics`
- –°–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ Dashboard
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
- Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `organizations.is_active` –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/blocked`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `FEATURES_SYSTEM.md`

**2. –ë–∞–Ω–Ω–µ—Ä–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `AdBanner` ‚Äî –ø–æ–∫–∞–∑ –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/partners` ‚Äî –≤—Å–µ –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- API routes –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞:
  - `POST /api/ads/impression` ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–æ–≤
  - `POST /api/ads/click` ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤
  - `GET /api/ads/active` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –¥–∞—Ç–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥ –ø–æ–∫–∞–∑–æ–≤ –∏ –∫–ª–∏–∫–æ–≤
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `ADS_IMPLEMENTATION.md`

**3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- `src/app/error.tsx` ‚Äî Error Boundary –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
- `src/app/global-error.tsx` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- –ö–Ω–æ–ø–∫–∏ "◊†◊°◊î ◊©◊ï◊ë" (–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞) –∏ "◊ó◊ñ◊ï◊® ◊ú◊ì◊£ ◊î◊ë◊ô◊™" (–ù–∞ –≥–ª–∞–≤–Ω—É—é)
- Dev mode –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏

**4. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è**
- Tailwind CSS –æ—Ç–∫–∞—á–µ–Ω –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é 3.4.17 (—Å 4.x beta)
- –û–±–Ω–æ–≤–ª–µ–Ω—ã `tailwind.config.js`, `postcss.config.mjs`, `globals.css`
- –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–º–µ—é—Ç `loading.tsx` skeletons
- RTL –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
3. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
4. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Supabase](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-supabase)
5. [API Routes](#api-routes)
6. [–°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#—Å—Ç—Ä–∞–Ω–∏—Ü—ã-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
7. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
8. [Hooks](#hooks)
9. [–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã](#–±–∏–±–ª–∏–æ—Ç–µ–∫–∏-–∏-—É—Ç–∏–ª–∏—Ç—ã)
10. [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
11. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è)

---

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**Trinity** ‚Äî –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è SaaS CRM —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –ø–ª–∞—Ç–µ–∂–∞–º–∏ –∏ SMS-—Ä–∞—Å—Å—ã–ª–∫–∞–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- **Multi-tenancy:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏:** CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, –∏—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤, –ø–ª–∞—Ç–µ–∂–µ–π
- **–ü–ª–∞—Ç–µ–∂–∏:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tranzilla (–ò–∑—Ä–∞–∏–ª—å)
- **SMS —Ä–∞—Å—Å—ã–ª–∫–∏:** InforU Mobile API
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –ì—Ä–∞—Ñ–∏–∫–∏ –¥–æ—Ö–æ–¥–æ–≤, –≤–∏–∑–∏—Ç–æ–≤, —Ç–æ–ø –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏, –±–∏–ª–ª–∏–Ω–≥, —Ä–µ–∫–ª–∞–º–∞
- **–°–∏—Å—Ç–µ–º–∞ —Ñ–∏—á:** –ì–∏–±–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
- **–ë–∞–Ω–Ω–µ—Ä–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞:** –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
- **RTL –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–≤—Ä–∏—Ç–∞

### –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:
- –ú–∞–ª—ã–π –∏ —Å—Ä–µ–¥–Ω–∏–π –±–∏–∑–Ω–µ—Å –≤ –ò–∑—Ä–∞–∏–ª–µ
- –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ (—Å–∞–ª–æ–Ω—ã –∫—Ä–∞—Å–æ—Ç—ã, –∞–≤—Ç–æ–º–æ–π–∫–∏, –∫–ª–∏–Ω–∏–∫–∏, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Å–ø–æ—Ä—Ç–∑–∞–ª—ã)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
clientbase-pro/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                                    # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/                              # ‚≠ê –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                      # Layout —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π is_admin()
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                        # –î–∞—à–±–æ—Ä–¥ –∞–¥–º–∏–Ω–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ organizations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ billing/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                    # –ë–∏–ª–ª–∏–Ω–≥ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ads/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                    # –†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page-safe.tsx              # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blocked/                            # ‚≠ê –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients/                            # –ö–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ loading.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments/                           # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ loading.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sms/                                # SMS —Ä–∞—Å—Å—ã–ª–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ loading.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats/                              # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ loading.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ partners/                           # ‚≠ê –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ loading.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ unauthorized/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ debug-admin/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                                # API Routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ check/route.ts             # ‚≠ê –ü—Ä–æ–≤–µ—Ä–∫–∞ is_admin()
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ads/                            # ‚≠ê –ë–ê–ù–ù–ï–†–ù–ê–Ø –†–ï–ö–õ–ê–ú–ê API
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ active/route.ts            # GET –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ click/route.ts             # POST —Ç—Ä–µ–∫–∏–Ω–≥ –∫–ª–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ impression/route.ts        # POST —Ç—Ä–µ–∫–∏–Ω–≥ –ø–æ–∫–∞–∑–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-link/route.ts       # POST —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhook/route.ts           # POST webhook Tranzilla
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callback/route.ts          # GET redirect –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sms/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ campaign/route.ts          # POST —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ send/route.ts              # POST –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ banner/route.ts            # POST –∑–∞–≥—Ä—É–∑–∫–∞ –±–∞–Ω–Ω–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health/route.ts                # GET health check
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ callback/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts                       # Auth callback
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                         # Root layout (RTL)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                           # Dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loading.tsx                        # Global loading
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ error.tsx                          # ‚≠ê Error Boundary
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ global-error.tsx                   # ‚≠ê Global error handler
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ not-found.tsx                      # 404 page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ globals.css                        # ‚≠ê Tailwind 3.x styles
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ads/                               # ‚≠ê –ë–ê–ù–ù–ï–†–ù–ê–Ø –†–ï–ö–õ–ê–ú–ê
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdBanner.tsx                   # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –±–∞–Ω–Ω–µ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddClientDialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ClientSheet.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreatePaymentDialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CreatePaymentLinkDialog.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sms/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewCampaignForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CampaignDetailsSheet.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx                    # ‚≠ê –° —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Ñ–∏—á
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdminSidebar.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ QueryProvider.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                                # shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ alert-dialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ badge.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dropdown-menu.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ label.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ select.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ separator.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sheet.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sonner.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ switch.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ table.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tabs.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ textarea.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ErrorBoundary.tsx
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useOrganization.ts                 # ‚≠ê –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useFeatures.ts                     # ‚≠ê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏—á
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useIsAdmin.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAdmin.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useClients.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usePayments.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSms.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useStats.ts
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts                        # Supabase –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase-browser.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tranzilla.ts                       # Tranzilla API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inforu.ts                          # InforU SMS API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts                           # CN —É—Ç–∏–ª–∏—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ       ‚îî‚îÄ‚îÄ database.ts                        # TypeScript —Ç–∏–ø—ã –ë–î
‚îú‚îÄ‚îÄ supabase/                                  # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ schema-v2.sql                          # –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ v2.0
‚îÇ   ‚îú‚îÄ‚îÄ schema-v2-part1.sql                    # Tables
‚îÇ   ‚îú‚îÄ‚îÄ schema-v2-part2.sql                    # RLS policies
‚îÇ   ‚îú‚îÄ‚îÄ schema-v2-part3.sql                    # Views
‚îÇ   ‚îú‚îÄ‚îÄ create-storage-bucket.sql              # Storage setup
‚îÇ   ‚îú‚îÄ‚îÄ quick-fix-ad-campaigns.sql
‚îÇ   ‚îî‚îÄ‚îÄ URGENT_FIX_RLS.sql
‚îú‚îÄ‚îÄ docs/                                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ADMIN_SETUP.md
‚îÇ   ‚îú‚îÄ‚îÄ ADS_IMPLEMENTATION.md                  # ‚≠ê –ë–∞–Ω–Ω–µ—Ä–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ FEATURES_SYSTEM.md                     # ‚≠ê –°–∏—Å—Ç–µ–º–∞ —Ñ–∏—á
‚îÇ   ‚îú‚îÄ‚îÄ SETUP.md
‚îÇ   ‚îú‚îÄ‚îÄ PAYMENTS_GUIDE.md
‚îÇ   ‚îú‚îÄ‚îÄ SMS_GUIDE.md
‚îÇ   ‚îî‚îÄ‚îÄ STORAGE_SETUP.md
‚îú‚îÄ‚îÄ tailwind.config.js                         # ‚≠ê Tailwind 3.x config
‚îú‚îÄ‚îÄ postcss.config.mjs                         # ‚≠ê PostCSS config
‚îú‚îÄ‚îÄ next.config.ts                             # Next.js config
‚îú‚îÄ‚îÄ middleware.ts                              # ‚≠ê –° –ø—Ä–æ–≤–µ—Ä–∫–æ–π is_active
‚îú‚îÄ‚îÄ package.json                               # ‚≠ê –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ components.json                            # shadcn/ui config
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ CLAUDE.md                                  # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Frontend Framework:
- **Next.js 16.1.6** (App Router)
  - Server Components –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - API Routes
  - Turbopack –¥–ª—è dev (—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π root)
  - Metadata API

### Language:
- **TypeScript 5.9.3**
  - –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
  - –¢–∏–ø—ã –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –ë–î

### Styling:
- **Tailwind CSS 3.4.17** ‚≠ê (–æ—Ç–∫–∞—á–µ–Ω–æ —Å 4.x beta)
  - Utility-first –ø–æ–¥—Ö–æ–¥
  - –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  - RTL –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **shadcn/ui 3.8.4**
  - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI
  - Radix UI primitives
  - –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–µ

### State Management:
- **React Query (@tanstack/react-query) 5.90.20**
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - Stale time: 5 –º–∏–Ω—É—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

### Database:
- **Supabase**
  - PostgreSQL
  - REST API (@supabase/supabase-js 2.95.3)
  - SSR support (@supabase/ssr 0.8.0)
  - Row Level Security (RLS)
  - Storage –¥–ª—è –±–∞–Ω–Ω–µ—Ä–æ–≤

### External APIs:
- **Tranzilla** ‚Äî –ø–ª–∞—Ç—ë–∂–Ω—ã–π —à–ª—é–∑ (–ò–∑—Ä–∞–∏–ª—å)
  - Sandbox: https://sandbox.tranzilla.co.il
  - Hosted payment page
- **InforU Mobile** ‚Äî SMS API (–ò–∑—Ä–∞–∏–ª—å)
  - REST API: https://api.inforu.co.il

### Charts & Analytics:
- **Recharts 3.7.0**
  - Bar Chart (—Å—Ç–æ–ª–±—á–∞—Ç—ã–µ)
  - Line Chart (–ª–∏–Ω–µ–π–Ω—ã–µ)
  - Horizontal Bar (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ)
  - Responsive
  - RTL —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Utilities:
- **date-fns 4.1.0** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏
- **zod 4.3.6** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **lucide-react 0.563.0** ‚Äî –∏–∫–æ–Ω–∫–∏
- **sonner 2.0.7** ‚Äî toast notifications
- **clsx / tailwind-merge** ‚Äî –∫–ª–∞—Å—Å—ã

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Supabase

### –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü:

---

#### 1. `organizations` ‚Äî –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–∫–ª–∏–µ–Ω—Ç—ã SaaS)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å, –∫–∞–∂–¥–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `name` | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ |
| `email` | TEXT | Email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ |
| `phone` | TEXT | –¢–µ–ª–µ—Ñ–æ–Ω |
| `category` | TEXT | salon/carwash/clinic/restaurant/gym/other |
| `plan` | TEXT | basic/pro/enterprise |
| `is_active` | BOOLEAN | –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ (–¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) |
| `features` | JSONB | {"sms": true, "payments": true, "analytics": true} |
| `billing_status` | TEXT | trial/paid/overdue/cancelled |
| `billing_due_date` | DATE | –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –æ–ø–ª–∞—Ç—ã |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `is_active`
- `useOrganization()` hook
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- AdBanner –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

---

#### 2. `org_users` ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `org_id` | UUID | FK ‚Üí organizations(id) |
| `user_id` | UUID | FK ‚Üí auth.users(id) |
| `email` | TEXT | Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `role` | TEXT | owner/admin/staff |
| `invited_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è |
| `joined_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è |

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- Middleware –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è org_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π

---

#### 3. `admin_users` ‚Äî –°—É–ø–µ—Ä–∞–¥–º–∏–Ω—ã —Å–∏—Å—Ç–µ–º—ã

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `user_id` | UUID | FK ‚Üí auth.users(id) |
| `email` | TEXT | Email –∞–¥–º–∏–Ω–∞ |
| `full_name` | TEXT | –ü–æ–ª–Ω–æ–µ –∏–º—è –∞–¥–º–∏–Ω–∞ ‚≠ê (v2.3) |
| `role` | TEXT | admin/moderator ‚≠ê (v2.4) |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è |

**–†–æ–ª–∏:**
- **admin** ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
- **moderator** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø (–ø—Ä–æ—Å–º–æ—Ç—Ä, –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤
- `/api/admin/check` –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `useIsAdmin()` hook

---

#### 4. `ad_campaigns` ‚Äî –†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `advertiser_name` | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è |
| `banner_url` | TEXT | URL –±–∞–Ω–Ω–µ—Ä–∞ (Supabase Storage) |
| `link_url` | TEXT | –°—Å—ã–ª–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ |
| `target_categories` | TEXT[] | –ú–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π ['salon', 'gym'] |
| `start_date` | DATE | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ |
| `end_date` | DATE | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è |
| `is_active` | BOOLEAN | –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∫–∞–º–ø–∞–Ω–∏—è |
| `clicks` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ |
| `impressions` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤ |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- `AdBanner` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `/partners` —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- API routes –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞
- –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

#### 5. `clients` ‚Äî –ö–ª–∏–µ–Ω—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `org_id` | UUID | FK ‚Üí organizations(id) |
| `first_name` | TEXT | –ò–º—è |
| `last_name` | TEXT | –§–∞–º–∏–ª–∏—è |
| `phone` | TEXT | –¢–µ–ª–µ—Ñ–æ–Ω |
| `email` | TEXT | Email (–æ–ø—Ü) |
| `address` | TEXT | –ê–¥—Ä–µ—Å (–æ–ø—Ü) |
| `date_of_birth` | DATE | –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü) |
| `notes` | TEXT | –ó–∞–º–µ—Ç–∫–∏ |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**RLS:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

---

#### 6. `visits` ‚Äî –í–∏–∑–∏—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `client_id` | UUID | FK ‚Üí clients(id) |
| `visit_date` | TIMESTAMPTZ | –î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞ |
| `service_description` | TEXT | –û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ |
| `amount` | NUMERIC(10,2) | –°—Ç–æ–∏–º–æ—Å—Ç—å |
| `notes` | TEXT | –ó–∞–º–µ—Ç–∫–∏ |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

---

#### 7. `payments` ‚Äî –ü–ª–∞—Ç–µ–∂–∏

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `client_id` | UUID | FK ‚Üí clients(id) |
| `visit_id` | UUID | FK ‚Üí visits(id) (–æ–ø—Ü) |
| `amount` | NUMERIC(10,2) | –°—É–º–º–∞ |
| `currency` | TEXT | ILS/USD/EUR |
| `status` | TEXT | pending/completed/failed/refunded |
| `payment_method` | TEXT | credit_card/cash |
| `payment_link` | TEXT | –°—Å—ã–ª–∫–∞ Tranzilla |
| `transaction_id` | TEXT | ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| `provider` | TEXT | tranzilla |
| `paid_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

---

#### 8. `sms_campaigns` ‚Äî SMS –∫–∞–º–ø–∞–Ω–∏–∏

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `org_id` | UUID | FK ‚Üí organizations(id) |
| `name` | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ |
| `message` | TEXT | –¢–µ–∫—Å—Ç SMS |
| `filter_type` | TEXT | all/single/inactive_days |
| `filter_value` | TEXT | –ó–Ω–∞—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ |
| `recipients_count` | INT | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π |
| `sent_count` | INT | –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ |
| `failed_count` | INT | –û—à–∏–±–æ–∫ |
| `status` | TEXT | draft/sending/completed/failed |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `sent_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ |

---

#### 9. `sms_messages` ‚Äî –û—Ç–¥–µ–ª—å–Ω—ã–µ SMS

**–ü–æ–ª—è:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | PRIMARY KEY |
| `campaign_id` | UUID | FK ‚Üí sms_campaigns(id) |
| `client_id` | UUID | FK ‚Üí clients(id) |
| `phone` | TEXT | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ |
| `message` | TEXT | –¢–µ–∫—Å—Ç |
| `status` | TEXT | pending/sent/delivered/failed |
| `error` | TEXT | –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ |
| `sent_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ |

---

### Views:

#### `client_summary` ‚Äî –°–≤–æ–¥–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º

```sql
SELECT 
  c.id,
  c.first_name,
  c.last_name,
  c.phone,
  c.email,
  MAX(v.visit_date) as last_visit,
  COUNT(v.id) as total_visits,
  COALESCE(SUM(p.amount), 0) as total_paid
FROM clients c
LEFT JOIN visits v ON v.client_id = c.id
LEFT JOIN payments p ON p.client_id = c.id AND p.status = 'completed'
GROUP BY c.id
```

---

### RLS Functions:

#### `get_user_org_ids()`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ org_id –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### `is_admin()`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤ `admin_users`

---

## üîå API Routes

### Payments API

#### `POST /api/payments/create-link`
–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏

**Request:**
```json
{
  "client_id": "uuid",
  "amount": 150.00,
  "description": "–û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥",
  "visit_id": "uuid"
}
```

**Response:**
```json
{
  "success": true,
  "payment_id": "uuid",
  "payment_link": "https://...",
  "amount": 150.00,
  "currency": "ILS"
}
```

---

#### `POST /api/payments/webhook`
Webhook –æ—Ç Tranzilla

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `Response` ‚Äî –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ ('000' = —É—Å–ø–µ—Ö)
- `ConfirmationCode` ‚Äî ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `contact` ‚Äî payment_id

**–û–±–Ω–æ–≤–ª—è–µ—Ç:** status, transaction_id, paid_at

---

#### `GET /api/payments/callback`
Redirect –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

**Query:**
- `status` ‚Äî success/failed
- `contact` ‚Äî payment_id

**Redirect:** `/payments?status=...&payment_id=...`

---

### SMS API

#### `POST /api/sms/campaign`
–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ SMS –∫–∞–º–ø–∞–Ω–∏–∏

**Request:**
```json
{
  "name": "◊™◊ñ◊õ◊ï◊®◊™ ◊ú◊ë◊ô◊ß◊ï◊®",
  "message": "◊©◊ú◊ï◊ù! ◊ñ◊ï ◊™◊ñ◊õ◊ï◊®◊™...",
  "filter_type": "all|single|inactive_days",
  "filter_value": "30"
}
```

**Response:**
```json
{
  "success": true,
  "campaign_id": "uuid",
  "recipients_count": 45,
  "sent_count": 43,
  "failed_count": 2
}
```

---

#### `POST /api/sms/send`
–ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS

**Request:**
```json
{
  "phones": ["+972501234567"],
  "message": "◊©◊ú◊ï◊ù!",
  "campaign_id": "uuid"
}
```

---

### Admin API

#### `POST /api/admin/check`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤

**Response:**
```json
{
  "isAdmin": true,
  "email": "admin@example.com"
}
```

---

#### `POST /api/admin/assign` ‚≠ê (v2.4)
–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º

**Request:**
```json
{
  "email": "user@example.com",
  "role": "admin" | "moderator"
}
```

**Response:**
```json
{
  "success": true,
  "message": "◊î◊û◊©◊™◊û◊© ◊û◊ï◊†◊î ◊ë◊î◊¶◊ú◊ó◊î"
}
```

**–û—à–∏–±–∫–∏:**
- 401: Not authenticated
- 403: Not an admin
- 404: "◊î◊û◊©◊™◊û◊© ◊¶◊®◊ô◊ö ◊ú◊î◊ô◊õ◊†◊° ◊ú◊û◊¢◊®◊õ◊™ ◊ú◊§◊ó◊ï◊™ ◊§◊¢◊ù ◊ê◊ó◊™"
- 400: Invalid role

---

#### `DELETE /api/admin/assign` ‚≠ê (v2.4)
–°–Ω—è—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏—è

**Request:**
```json
{
  "email": "user@example.com"
}
```

**Response:**
```json
{
  "success": true,
  "message": "◊î◊î◊®◊©◊ê◊ï◊™ ◊î◊ï◊°◊®◊ï ◊ë◊î◊¶◊ú◊ó◊î"
}
```

**–ó–∞—â–∏—Ç–∞:** –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–µ–±—è

---

### Ads API (‚≠ê –ù–æ–≤–æ–µ)

#### `GET /api/ads/active?category={category}`
–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π

**Query:**
- `category` ‚Äî salon/carwash/clinic/etc

**–§–∏–ª—å—Ç—Ä—ã:**
- `is_active = true`
- `start_date <= today <= end_date`
- `target_categories` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é

**Response:**
```json
{
  "campaigns": [
    {
      "id": "uuid",
      "advertiser_name": "◊ß◊ï◊°◊û◊ò◊ô◊ß◊î ◊ú◊ô",
      "banner_url": "https://...",
      "link_url": "https://...",
      "target_categories": ["salon"],
      "clicks": 15,
      "impressions": 42
    }
  ]
}
```

---

#### `POST /api/ads/impression`
–¢—Ä–µ–∫–∏–Ω–≥ –ø–æ–∫–∞–∑–∞ –±–∞–Ω–Ω–µ—Ä–∞

**Request:**
```json
{
  "campaign_id": "uuid"
}
```

**Response:**
```json
{
  "success": true,
  "impressions": 43
}
```

---

#### `POST /api/ads/click`
–¢—Ä–µ–∫–∏–Ω–≥ –∫–ª–∏–∫–∞ –ø–æ –±–∞–Ω–Ω–µ—Ä—É

**Request:**
```json
{
  "campaign_id": "uuid"
}
```

**Response:**
```json
{
  "success": true,
  "clicks": 16
}
```

---

## üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### `/` ‚Äî Dashboard (–ì–ª–∞–≤–Ω–∞—è)

**–§–∞–π–ª:** `src/app/page.tsx`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active` –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/blocked`)
- 4 –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ç—Ä–∏–∫:
  - ◊°◊î◊¥◊õ ◊ú◊ß◊ï◊ó◊ï◊™ (–≤—Å–µ–≥–¥–∞)
  - ◊ë◊ô◊ß◊ï◊®◊ô◊ù ◊î◊ó◊ï◊ì◊© (–≤—Å–µ–≥–¥–∞)
  - ‚≠ê ◊î◊õ◊†◊°◊ï◊™ ◊î◊ó◊ï◊ì◊© (–µ—Å–ª–∏ `hasPayments`)
  - ‚≠ê ◊ú◊ß◊ï◊ó◊ï◊™ ◊ú◊ê ◊§◊¢◊ô◊ú◊ô◊ù (–µ—Å–ª–∏ `hasAnalytics`)
- ‚≠ê AdBanner —Å–ø—Ä–∞–≤–∞ –æ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑ `features.category`)
- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—Å—Å—ã–ª–∫–∏)
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö

**–î–∞–Ω–Ω—ã–µ:** `useDashboardStats()`, `useFeatures()`

---

### `/clients` ‚Äî –ö–ª–∏–µ–Ω—Ç—ã

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active`
- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ (client_summary view)
- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω—É
- –ö–ª–∏–∫ –Ω–∞ —Å—Ç—Ä–æ–∫—É ‚Üí ClientSheet
- –ö–Ω–æ–ø–∫–∞ "◊î◊ï◊°◊£ ◊ú◊ß◊ï◊ó"

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `AddClientDialog`
- `ClientSheet` (—Ç–∞–±—ã: –í–∏–∑–∏—Ç—ã | –ü–ª–∞—Ç–µ–∂–∏ | SMS)

---

### `/payments` ‚Äî –ü–ª–∞—Ç–µ–∂–∏

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active` –∏ `hasPayments` (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü
- –§–∏–ª—å—Ç—Ä—ã: —Å—Ç–∞—Ç—É—Å, –¥–∞—Ç—ã
- –¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- –ë–µ–π–¥–∂–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ (—Ü–≤–µ—Ç–Ω—ã–µ)
- –î–µ–π—Å—Ç–≤–∏—è: –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É, –æ—Ç–∫—Ä—ã—Ç—å

**Toast –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `?status=success&payment_id=...`

---

### `/sms` ‚Äî SMS —Ä–∞—Å—Å—ã–ª–∫–∏

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active` –∏ `hasSms` (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/`)
- –§–æ—Ä–º–∞ –Ω–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
- –ü–æ–¥—Å—á—ë—Ç —Å–∏–º–≤–æ–ª–æ–≤/SMS
- 3 —Ç–∏–ø–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–≤—Å–µ–º/–æ–¥–Ω–æ–º—É/–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º)
- –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫
- –ö–ª–∏–∫ ‚Üí CampaignDetailsSheet

---

### `/stats` ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active` –∏ `hasAnalytics` (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/`)
- 4 –∫–∞—Ä—Ç–æ—á–∫–∏ (—Ç–µ –∂–µ —á—Ç–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π)
- 3 –≥—Ä–∞—Ñ–∏–∫–∞:
  - –î–æ—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º (Bar Chart)
  - –í–∏–∑–∏—Ç—ã –ø–æ –º–µ—Å—è—Ü–∞–º (Line Chart)
  - –¢–æ–ø-5 –∫–ª–∏–µ–Ω—Ç–æ–≤ (Horizontal Bar)

---

### `/partners` ‚Äî –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (‚≠ê –ù–æ–≤–æ–µ)

**–§–∞–π–ª:** `src/app/partners/page.tsx`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active`
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- Grid layout (1/2/3 –∫–æ–ª–æ–Ω–∫–∏)
- –ö–∞–∂–¥—ã–π –±–∞–Ω–Ω–µ—Ä:
  - –ö–∞—Ä—Ç–∏–Ω–∫–∞ 250px
  - –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è
  - –ö–Ω–æ–ø–∫–∞ "◊ú◊§◊®◊ò◊ô◊ù"
- –ö–ª–∏–∫ ‚Üí —Ç—Ä–µ–∫–∏–Ω–≥ + –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Å—ã–ª–∫–∏
- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: "◊ê◊ô◊ü ◊î◊¶◊¢◊ï◊™ ◊ñ◊û◊ô◊†◊ï◊™ ◊õ◊®◊í◊¢"

**–î–∞–Ω–Ω—ã–µ:** `/api/ads/active?category=...`, `useFeatures()`

---

### `/admin` ‚Äî –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**–ó–∞—â–∏—Ç–∞:** –¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `admin_users`

**–†–∞–∑–¥–µ–ª—ã:**
- Dashboard ‚Äî –º–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- Organizations ‚Äî CRUD –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- Billing ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- Ads ‚Äî —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
- Settings ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

### `/blocked` ‚Äî –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:** `organizations.is_active = false`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- –ü—Ä–∏—á–∏–Ω–∞ (–Ω–µ–æ–ø–ª–∞—Ç–∞, –Ω–∞—Ä—É—à–µ–Ω–∏–µ)
- –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Ads (‚≠ê –ù–æ–≤–æ–µ)

#### `AdBanner`
**–ü—É—Ç—å:** `src/components/ads/AdBanner.tsx`

**Props:**
```typescript
{
  category: string    // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
  className?: string
}
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é
- –¢—Ä–µ–∫–∞–µ—Ç –ø–æ–∫–∞–∑ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ mount
- –ö–ª–∏–∫ ‚Üí —Ç—Ä–µ–∫–∏–Ω–≥ + –æ—Ç–∫—Ä—ã—Ç–∏–µ link_url
- –ï—Å–ª–∏ –Ω–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π ‚Üí null (–Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è)

**–°—Ç–∏–ª—å:**
- –°–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã (rounded-lg)
- –¢–µ–Ω—å (shadow-md)
- Hover: scale(1.02)
- –ü–æ–¥–ø–∏—Å—å "◊©◊ï◊™◊£ ◊¢◊°◊ß◊ô" –≤–Ω–∏–∑—É

---

### Clients

#### `AddClientDialog`
–ú–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞

**–ü–æ–ª—è:** –∏–º—è, —Ñ–∞–º–∏–ª–∏—è, —Ç–µ–ª–µ—Ñ–æ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ), email, –∞–¥—Ä–µ—Å, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è, –∑–∞–º–µ—Ç–∫–∏

#### `ClientSheet` ‚≠ê (v2.4)
–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫–ª–∏–µ–Ω—Ç–∞

**–°–µ–∫—Ü–∏–∏:**
- –ö–æ–Ω—Ç–∞–∫—Ç—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –î–µ–π—Å—Ç–≤–∏—è (—Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å SMS, –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–∑–∏—Ç)
- –¢–∞–±—ã (–í–∏–∑–∏—Ç—ã | –ü–ª–∞—Ç–µ–∂–∏ | SMS)
- **‚≠ê –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–º:**
  - –ö–Ω–æ–ø–∫–∞ "◊û◊†◊î ◊õ◊û◊†◊î◊ú" (—è–Ω—Ç–∞—Ä–Ω–∞—è) ‚Äî –µ—Å–ª–∏ –ù–ï –∞–¥–º–∏–Ω
  - Badge "◊û◊†◊î◊ú ◊û◊¢◊®◊õ◊™" + –∫–Ω–æ–ø–∫–∞ "◊î◊°◊® ◊î◊®◊©◊ê◊ï◊™" ‚Äî –µ—Å–ª–∏ –∞–¥–º–∏–Ω
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ email –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useClientAdminStatus` hook

#### `AssignAdminDialog` ‚≠ê (v2.4)
**–ü—É—Ç—å:** `src/components/clients/AssignAdminDialog.tsx`

**Props:**
- `open: boolean`
- `onOpenChange: (open: boolean) => void`
- `clientEmail: string`
- `onSuccess?: () => void`

**–§—É–Ω–∫—Ü–∏–∏:**
- –í—ã–±–æ—Ä —Ä–æ–ª–∏ (admin/moderator)
- –ö—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏
- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤ –Ω–∞ –∏–≤—Ä–∏—Ç–µ
- POST /api/admin/assign

---

### Payments

#### `CreatePaymentDialog`
–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

#### `CreatePaymentLinkDialog`
–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —Å –≤—ã–±–æ—Ä–æ–º –∫–ª–∏–µ–Ω—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∫–∞–∑ —Å—Å—ã–ª–∫–∏ + –∫–Ω–æ–ø–∫–∏ (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å SMS, –æ—Ç–∫—Ä—ã—Ç—å)

---

### SMS

#### `NewCampaignForm`
–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è SMS –∫–∞–º–ø–∞–Ω–∏–∏

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–¥—Å—á—ë—Ç —Å–∏–º–≤–æ–ª–æ–≤ –∏ SMS —á–∞—Å—Ç–µ–π
- Live preview –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
- 3 —Ç–∏–ø–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Ä–∞–¥–∏–æ + –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è)
- –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

#### `CampaignDetailsSheet`
–î–µ—Ç–∞–ª–∏ SMS –∫–∞–º–ø–∞–Ω–∏–∏

**–°–µ–∫—Ü–∏–∏:**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –¢–µ–∫—Å—Ç
- –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö SMS

---

### Layout

#### `Sidebar` (‚≠ê –û–±–Ω–æ–≤–ª—ë–Ω)
**–ü—É—Ç—å:** `src/components/layout/Sidebar.tsx`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚≠ê –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ `features`:
  - "◊™◊©◊ú◊ï◊û◊ô◊ù" ‚Üí –µ—Å–ª–∏ `hasPayments`
  - "◊î◊ï◊ì◊¢◊ï◊™ SMS" ‚Üí –µ—Å–ª–∏ `hasSms`
  - "◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊î" ‚Üí –µ—Å–ª–∏ `hasAnalytics`
  - "◊ú◊ß◊ï◊ó◊ï◊™" –∏ "◊î◊¶◊¢◊ï◊™ ◊©◊ï◊™◊§◊ô◊ù" ‚Üí –≤—Å–µ–≥–¥–∞
- –ö–Ω–æ–ø–∫–∞ "◊ê◊ì◊û◊ô◊ü" –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- –ê–∫—Ç–∏–≤–Ω—ã–π –ø—É–Ω–∫—Ç –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è
- RTL layout

**–î–∞–Ω–Ω—ã–µ:** `useFeatures()`, `useIsAdmin()`

#### `AdminSidebar`
Sidebar –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (—Ç—ë–º–Ω—ã–π #1E293B)

---

### Error Handling (‚≠ê –ù–æ–≤–æ–µ)

#### `error.tsx`
**–ü—É—Ç—å:** `src/app/error.tsx`

Error Boundary –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫

**–§—É–Ω–∫—Ü–∏–∏:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ console.error
- –ö—Ä–∞—Å–∏–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π –æ—à–∏–±–∫–∏
- Dev mode ‚Üí –ø–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ö–Ω–æ–ø–∫–∏: "◊†◊°◊î ◊©◊ï◊ë" (reset), "◊ó◊ñ◊ï◊® ◊ú◊ì◊£ ◊î◊ë◊ô◊™"

#### `global-error.tsx`
**–ü—É—Ç—å:** `src/app/global-error.tsx`

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (–æ–±—Ö–æ–¥–∏—Ç root layout)

**–§—É–Ω–∫—Ü–∏–∏:**
- Inline HTML –±–µ–∑ layout
- RTL `dir="rtl"`
- Inline —Å—Ç–∏–ª–∏
- –ö–Ω–æ–ø–∫–∞ "◊†◊°◊î ◊©◊ï◊ë"

---

## üé£ Hooks

### useOrganization() (‚≠ê –ù–æ–≤–æ–µ)
**–ü—É—Ç—å:** `src/hooks/useOrganization.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. `supabase.auth.getUser()`
2. SELECT org_id FROM org_users WHERE user_id = ...
3. SELECT * FROM organizations WHERE id = org_id
4. –í–æ–∑–≤—Ä–∞—Ç Organization –æ–±—ä–µ–∫—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```typescript
interface Organization {
  id: string
  name: string
  category: string
  plan: string
  is_active: boolean
  features: {
    sms: boolean
    payments: boolean
    analytics: boolean
  }
  billing_status: string
  // ...
}
```

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Query key: `['organization']`
- Stale time: 5 –º–∏–Ω—É—Ç

---

### useFeatures() (‚≠ê –ù–æ–≤–æ–µ)
**–ü—É—Ç—å:** `src/hooks/useFeatures.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏—á

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** `useOrganization()`

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```typescript
interface Features {
  hasSms: boolean
  hasPayments: boolean
  hasAnalytics: boolean
  isActive: boolean
  category: string
  isLoading: boolean
}
```

**Fallback:** –ï—Å–ª–∏ features –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Üí –≤—Å–µ true

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- Sidebar (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ–Ω—é)
- Dashboard (—Å–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫)
- –°—Ç—Ä–∞–Ω–∏—Ü—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞)
- AdBanner (–∫–∞—Ç–µ–≥–æ—Ä–∏—è)

---

### useClients()
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º

### useClient(id)
–û–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –ø–æ ID

### useAddClient()
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

### useUpdateClient()
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

---

### usePayments(clientId?, filters?)
–°–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

### usePaymentsStats()
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü

### useCreatePaymentLink()
–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏

---

### useSmsCampaigns()
–°–ø–∏—Å–æ–∫ SMS –∫–∞–º–ø–∞–Ω–∏–π

### useSmsCampaign(id)
–û–¥–Ω–∞ –∫–∞–º–ø–∞–Ω–∏—è

### useSmsMessages(campaignId)
SMS —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–∏

### useCreateCampaign()
–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –∫–∞–º–ø–∞–Ω–∏–∏

### useRecipientsCount(filterType, filterValue?)
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (preview)

---

### useDashboardStats()
–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞

### useRevenueByMonth()
–î–æ—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º (6 –º–µ—Å—è—Ü–µ–≤)

### useVisitsByMonth()
–í–∏–∑–∏—Ç—ã –ø–æ –º–µ—Å—è—Ü–∞–º

### useTopClients()
–¢–æ–ø-5 –∫–ª–∏–µ–Ω—Ç–æ–≤

---

### useAuth()
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (signIn, signOut, user)

### useIsAdmin()
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞ —á–µ—Ä–µ–∑ `/api/admin/check`

### useAdminProfile() (‚≠ê v2.3)
**–ü—É—Ç—å:** `src/hooks/useAdminProfile.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∞–¥–º–∏–Ω–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `admin_users`

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** `useAuth()`

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```typescript
interface AdminProfile {
  id: string
  user_id: string
  email: string
  full_name: string | null
  created_at: string
}

{
  adminProfile: AdminProfile | null
  isLoading: boolean
  error: Error | null
}
```

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Query key: `['admin-profile', userId]`
- Stale time: 5 –º–∏–Ω—É—Ç

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- AdminSidebar (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ email)

---

### useClientAdminStatus() ‚≠ê (v2.4)
**–ü—É—Ç—å:** `src/hooks/useClientAdminStatus.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª–∏–µ–Ω—Ç –∞–¥–º–∏–Ω–æ–º

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```typescript
interface AdminStatus {
  isAdmin: boolean
  role: 'admin' | 'moderator' | null
}

{
  isAdmin: boolean
  role: 'admin' | 'moderator' | null
  isLoading: boolean
  refetch: () => void
}
```

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Query key: `['client-admin-status', email]`
- Stale time: 30 —Å–µ–∫—É–Ω–¥

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- ClientSheet (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ –∫–Ω–æ–ø–æ–∫)

---

## üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã

### `src/lib/supabase.ts`
Supabase –∫–ª–∏–µ–Ω—Ç (ANON KEY)

### `src/lib/supabase-browser.ts`
Browser-safe –∫–ª–∏–µ–Ω—Ç

### `src/lib/tranzilla.ts`
Tranzilla API —É—Ç–∏–ª–∏—Ç—ã:
- `generateTranzillaPaymentLink()`
- `parseTranzillaWebhook()`
- `formatAmount()`
- `getPaymentStatus()`

### `src/lib/inforu.ts`
InforU SMS API —É—Ç–∏–ª–∏—Ç—ã:
- `sendSms()`
- `formatPhoneNumber()`
- `calculateSmsParts()`
- `isValidIsraeliPhone()`

### `src/lib/utils.ts`
shadcn/ui —É—Ç–∏–ª–∏—Ç—ã:
```typescript
import { cn } from '@/lib/utils'
```

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `.env.local`

```env
# Supabase (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Tranzilla (–ø–ª–∞—Ç–µ–∂–∏)
TRANZILLA_TERMINAL_ID=your_terminal_id
TRANZILLA_API_KEY=your_api_key

# InforU Mobile (SMS)
INFORU_API_TOKEN=your_api_token
INFORU_SENDER_NAME=YourBusiness
```

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. Multi-Tenancy —á–µ—Ä–µ–∑ organizations
- –ö–∞–∂–¥–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞
- RLS –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- org_id –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Ç–∞–±–ª–∏—Ü

### 2. –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—á–∞–º–∏ (‚≠ê v2.2)
- JSONB –ø–æ–ª–µ `features` –≤ organizations
- –•—É–∫–∏ `useFeatures()` –∏ `useOrganization()`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è UI
- Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `is_active`
- ‚≠ê **API routes –∑–∞—â–∏—â–µ–Ω—ã:** `api-auth.ts` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç features –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- 3 —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã: middleware, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, API routes
- –ê–¥–º–∏–Ω—ã –º–∏–Ω—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫—É features

### 3. –ë–∞–Ω–Ω–µ—Ä–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ (‚≠ê v2.1)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–æ–≤ –≤ Supabase Storage
- –¢–∞—Ä–≥–µ—Ç–∏–Ω–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º
- –¢—Ä–µ–∫–∏–Ω–≥ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (impressions/clicks)
- API –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø—É–±–ª–∏—á–Ω—ã–π)
- CTR —Ä–∞—Å—á—ë—Ç –≤ –∞–¥–º–∏–Ω–∫–µ

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (‚≠ê v2.1)
- Error Boundary –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü
- Global error handler –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- –ö–Ω–æ–ø–∫–∏ recovery (reset, home)
- Dev mode –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏

### 5. React Query –¥–ª—è state management
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (5 –º–∏–Ω—É—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
- –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 6. Supabase –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ state
- –í—Å–µ —á–µ—Ä–µ–∑ REST API
- Views –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

### 7. RTL (Right-to-Left) Layout (‚≠ê v2.3 - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!)
**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- `dir="rtl"` –≤ root layout
- **–ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:** main ‚Üí sidebar (sidebar –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ø—Ä–∞–≤–∞)
- **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º `flex-row-reverse`** ‚Äî RTL —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ
- **Desktop (‚â•1024px):**
  - `lg:flex lg:h-screen` ‚Äî flex container –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É
  - `<main className="flex-1 overflow-y-auto">` ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
  - `<aside className="sticky top-0 h-screen">` ‚Äî sidebar —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω, –Ω–µ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è
- **Mobile (<1024px):**
  - Sidebar —Å–∫—Ä—ã—Ç (`hidden lg:block`)
  - MobileHeader —Å –±—É—Ä–≥–µ—Ä–æ–º
  - Drawer –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞ (RTL)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Sidebar:**
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç `<div>` –≤–º–µ—Å—Ç–æ `<aside>` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ flow
  - `h-full` –≤–º–µ—Å—Ç–æ `h-screen` ‚Äî –∑–∞–ø–æ–ª–Ω—è—é—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä layout
  - –í–µ—Å—å —Ç–µ–∫—Å—Ç –Ω–∞ –∏–≤—Ä–∏—Ç–µ
  - Recharts –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ–¥ RTL

### 8. –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é (‚≠ê v2.2)
- `MobileHeader` + `MobileSidebar` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- `MobileAdminHeader` + `MobileAdminSidebar` –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
- Drawer –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞ (Sheet component)
- Backdrop –∏ body scroll lock
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—É–Ω–∫—Ç–∞
- –ö–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥" –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∫—Ä–æ–º–µ –≥–ª–∞–≤–Ω–æ–π
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ <1024px (`lg:hidden`)

### 9. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (‚≠ê v2.2)
- Dark/Light —Ä–µ–∂–∏–º –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- localStorage –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –ò–∫–æ–Ω–∫–∏ Moon/Sun
- `darkMode: ['class']` –≤ tailwind.config.js
- CSS variables –¥–ª—è —Ü–≤–µ—Ç–æ–≤ (`--background`, `--card`, etc.)
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ

### 10. shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–µ
- Tailwind CSS —Å—Ç–∏–ª–∏
- Radix UI primitives
- Sheet –¥–ª—è drawer –º–µ–Ω—é

### 11. API Routes –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- Tranzilla: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫
- InforU: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS
- Ads: —Ç—Ä–µ–∫–∏–Ω–≥ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è
- ‚≠ê –ó–∞—â–∏—Ç–∞ features —á–µ—Ä–µ–∑ `api-auth.ts` (v2.2)

### 12. TypeScript —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- –¢–∏–ø—ã –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –ë–î
- –¢–∏–ø—ã –¥–ª—è API responses
- –¢–∏–ø—ã –¥–ª—è props –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 13. Loading states –∏ Error handling
- `loading.tsx` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ route
- `error.tsx` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- `not-found.tsx` –¥–ª—è 404

### 14. Middleware –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ session
- –ü—Ä–æ–≤–µ—Ä–∫–∞ org membership
- –ü—Ä–æ–≤–µ—Ä–∫–∞ admin rights
- –ü—Ä–æ–≤–µ—Ä–∫–∞ is_active (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /blocked)
- –ü—É–±–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏: /login, /unauthorized, /blocked

### 15. Tailwind 3.x
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è 3.4.17 (–æ—Ç–∫–∞—Ç —Å 4.x beta)
- `darkMode: ['class']` –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ CSS variables
- –ü–ª–∞–≥–∏–Ω tailwindcss-animate
- PostCSS —Å autoprefixer

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞
npm run dev

# –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm run build

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞
npm start

# –õ–∏–Ω—Ç–∏–Ω–≥
npm run lint
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ v2.3.0

- **–°—Ç—Ä–∞–Ω–∏—Ü:** 13 (–≤–∫–ª—é—á–∞—è –∞–¥–º–∏–Ω–∫—É)
- **API Routes:** 13
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:** 36 (+6 layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
  - Layout: 6 (Sidebar, MobileSidebar, MobileHeader, AdminSidebar, MobileAdminSidebar, MobileAdminHeader)
  - UI: 17 (shadcn/ui)
  - Features: 7 (clients, payments, sms)
  - Ads: 1 (AdBanner)
  - Providers: 1 (QueryProvider)
  - ErrorBoundary: 1
- **–•—É–∫–æ–≤:** 9
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫:** 7 (supabase, supabase-browser, tranzilla, inforu, utils, api-auth)
- **–¢–∞–±–ª–∏—Ü –ë–î:** 9
- **Views:** 1 (client_summary)
- **RLS Functions:** 2 (get_user_org_ids, is_admin)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 12 —Ñ–∞–π–ª–æ–≤
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~10000+

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. ~~**API Routes –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã features**~~ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ v2.2 (api-auth.ts)
2. **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ middleware:** SELECT –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis/cookies)
3. **features –º–æ–∂–µ—Ç –±—ã—Ç—å null:** –ù—É–∂–µ–Ω –¥–µ—Ñ–æ–ª—Ç –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö (—Å–µ–π—á–∞—Å fallback –≤ –∫–æ–¥–µ)
4. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ–∫–∞–∑–æ–≤ –±–∞–Ω–Ω–µ—Ä–∞:** Impression —Ç—Ä–µ–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ mount (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å cookie/localStorage)

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`docs/`):
- `ADMIN_SETUP.md` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- `ADS_IMPLEMENTATION.md` ‚≠ê ‚Äî –±–∞–Ω–Ω–µ—Ä–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ (v2.1)
- `FEATURES_SYSTEM.md` ‚≠ê ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—á–∞–º–∏ (v2.1)
- `SETUP.md` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- `PAYMENTS_GUIDE.md` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏
- `SMS_GUIDE.md` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å SMS
- `STORAGE_SETUP.md` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Storage

### SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (`supabase/`):
- `schema-v2.sql` ‚Äî –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ v2.0
- `schema-v2-part1.sql` ‚Äî —Ç–∞–±–ª–∏—Ü—ã
- `schema-v2-part2.sql` ‚Äî RLS policies
- `schema-v2-part3.sql` ‚Äî views
- `create-storage-bucket.sql` ‚Äî Storage –¥–ª—è –±–∞–Ω–Ω–µ—Ä–æ–≤
- `quick-fix-ad-campaigns.sql` ‚Äî –±—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- `URGENT_FIX_RLS.sql` ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RLS

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ:
- [ ] –ó–∞—â–∏—Ç–∞ API routes —á–µ—Ä–µ–∑ features
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (Redis/cookies)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV/PDF)
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ:
- [ ] –ì–µ–æ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–æ–≤
- [ ] –õ–∏–º–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (100 SMS/–º–µ—Å—è—Ü)
- [ ] Feature flags (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ)
- [ ] WhatsApp Business –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:
- [ ] AI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [ ] API –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

---

## ‚ö†Ô∏è –î–ª—è Production –¥–µ–ø–ª–æ—è

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Supabase SQL Editor
cat supabase/schema-v2.sql | pbcopy
# –í—Å—Ç–∞–≤–∏—Ç—å –≤ Supabase Dashboard ‚Üí SQL Editor

# –°–æ–∑–¥–∞—Ç—å Storage bucket
cat supabase/create-storage-bucket.sql | pbcopy
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
# .env.local —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
cp .env.example .env.local
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å SUPABASE_URL, KEYS, TRANZILLA, INFORU
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –±–∏–ª–¥:
```bash
npm install
npm run build
npm start
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ SMS
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (`is_active = false`)
- [ ] –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏—á (features)
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–Ω–Ω–µ—Ä–æ–≤
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–¥–æ–±–∞–≤–∏—Ç—å –≤ admin_users)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-09 20:45 UTC

**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 2.3.0

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

**–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è v2.3:**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π RTL Layout** ‚Äî sidebar —Å–ø—Ä–∞–≤–∞ sticky, –∫–æ–Ω—Ç–µ–Ω—Ç —Å–ª–µ–≤–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ –£–±—Ä–∞–Ω `flex-row-reverse` ‚Äî RTL —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Sidebar (aside ‚Üí div, h-screen ‚Üí h-full)
- ‚úÖ Dark mode —É–ª—É—á—à–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è v2.2:**
- ‚úÖ **API routes –∑–∞—â–∏—â–µ–Ω—ã features** ‚Äî api-auth.ts –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é —Å –±—É—Ä–≥–µ—Ä–æ–º (–æ—Å–Ω–æ–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ + –∞–¥–º–∏–Ω–∫–∞)
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã Dark/Light –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏
- ‚úÖ 3 —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã: middleware ‚Üí UI ‚Üí API

**–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è v2.1:**
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—á–∞–º–∏
- ‚úÖ –ë–∞–Ω–Ω–µ—Ä–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Tailwind 3.x (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å loading states
- ‚úÖ Middleware —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π is_active
- ‚úÖ RTL –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –∏–≤—Ä–∏—Ç–µ
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ö–æ–º–º–∏—Ç—ã:**
- `b3645ab` (2026-02-09 20:45) ‚Äî fix: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π RTL layout - sidebar —Å–ø—Ä–∞–≤–∞ sticky
- `0ac0921` (2026-02-09 20:00) ‚Äî Sidebar fix
- `e748f02` (2026-02-09 18:26) ‚Äî feat: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ responsive –ª–æ–≥–∏–∫–∞ sidebar (RTL) + –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
- `c19bd26` ‚Äî feat: –¥–æ–±–∞–≤–ª–µ–Ω–æ –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- `0d18b5e` ‚Äî feat: –¥–æ–±–∞–≤–ª–µ–Ω–æ –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é —Å –±—É—Ä–≥–µ—Ä–æ–º
- `f6874de` ‚Äî feat: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ features –≤ API routes

---

_–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ (Claude, GPT, –∏ –¥—Ä.) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞._

_Powered by Amber Solutions Systems ¬© 2026_
