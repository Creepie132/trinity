# 💳 Руководство по системе платежей

## 📊 Страница платежей

**URL:** `/payments`

### Функции:

#### 1. **Статистика (верхняя панель)**
- 💰 Общая сумма оплат за текущий месяц
- ✅ Количество успешных транзакций  
- 📊 Средний чек

#### 2. **Фильтры**
- **По статусу:**
  - Все
  - Ммтין (pending)
  - Шулм (completed)
  - Нкшл (failed)
  - Хухзр (refunded)
  
- **По дате:**
  - Мтарих (от)
  - Ад тарих (до)

#### 3. **Таблица платежей**

**Столбцы:**
- Лакоах (Клиент)
- Схум (Сумма)
- Статус (с цветными бейджами)
- Амцаи ташлум (Метод оплаты)
- Тарих (Дата)
- Пеулот (Действия)

**Действия:**
- 📋 Копировать ссылку на оплату
- 🔗 Открыть ссылку
- 👁️ Просмотреть детали (при наличии transaction_id)

#### 4. **Кнопка "צור קישור לתשלום"**

**Создание платёжной ссылки:**

1. Нажми кнопку "צור קישור לתשלום"
2. Выбери клиента:
   - Поиск по имени/телефону
   - Выпадающий список
3. Введи сумму (₪)
4. Опционально: добавь описание
5. Нажми "צור קישור"

**После создания:**
- ✅ Показывается успешное сообщение
- 📋 Кнопка "העתק קישור" — копирует ссылку
- 📱 Кнопка "שלח ב-SMS" — отправка по SMS (в разработке)
- 🔗 Кнопка "פתח קישור" — открывает в новой вкладке

## 🎨 Цветовая схема статусов

- 🟢 **Зелёный (completed)** — шולм (оплачен)
- 🟡 **Жёлтый (pending)** — ммтин (ожидание)
- 🔴 **Красный (failed)** — нкшл (ошибка)
- ⚪ **Серый (refunded)** — хухзр (возврат)

## 🔗 Интеграция с клиентами

В карточке клиента (ClientSheet):
- Кнопка "צור קישור תשלום"
- Открывает диалог создания платежа
- Клиент уже выбран
- Вкладка "תשלומים" показывает историю

## 🧪 Тестирование

### 1. Создать платёж:
```
1. Открой /payments
2. Нажми "צור קישור לתשלום"
3. Выбери клиента
4. Введи сумму: 150
5. Нажми "צור קישור"
6. Скопируй ссылку
```

### 2. Тестовая оплата:
```
1. Открой скопированную ссылку
2. Введи тестовую карту: 4444-3333-2222-1111
3. CVV: 123, Exp: 01/26
4. Подтверди
5. Вернись на /payments
6. Статус должен измениться на "שולם"
```

### 3. Фильтры:
```
1. Выбери статус "ממתין"
2. Установи даты
3. Таблица обновится автоматически
```

## 📱 Мобильная версия

- Таблица адаптируется
- Статистика переходит в одну колонку
- Фильтры располагаются вертикально

## 🔄 Автообновление

После создания платежа:
- ✅ Список платежей обновляется автоматически (React Query)
- ✅ Статистика пересчитывается
- ✅ Фильтры сохраняются

## 💡 Советы

- Используй поиск клиента для быстрого выбора
- Копируй ссылку и отправляй через WhatsApp/Telegram
- Проверяй статус в таблице
- Смотри статистику для анализа

## 🚀 Готово к использованию!

Страница платежей полностью интегрирована с:
- ✅ Supabase (БД)
- ✅ Tranzilla (платёжный шлюз)
- ✅ React Query (кэширование)
- ✅ RTL интерфейс на иврите
