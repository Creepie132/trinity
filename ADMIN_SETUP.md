# Admin Setup Guide

## 0. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–í–ê–ñ–ù–û!)

–î–ª—è —Ä–∞–±–æ—Ç—ã –∞–¥–º–∏–Ω–∫–∏ –Ω—É–∂–µ–Ω **Service Role Key** –∏–∑ Supabase:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí API**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **service_role key** (–ù–ï –ø—É—Ç–∞–π—Ç–µ —Å anon key!)
5. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`:

```env
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** Service role key –æ–±—Ö–æ–¥–∏—Ç RLS –∏ –¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ë–î. **–ù–ï** –ø—É–±–ª–∏–∫—É–π—Ç–µ –µ–≥–æ –≤ Git!

6. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
npm run dev
```

---

## 1. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Supabase SQL Editor

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –ù–∞–π–¥–∏—Ç–µ –≤–∞—à user_id (–ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
SELECT id, email FROM auth.users;

-- –î–æ–±–∞–≤—å—Ç–µ —Å–µ–±—è –∫–∞–∫ –∞–¥–º–∏–Ω–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_USER_ID –∏ YOUR_EMAIL)
INSERT INTO admin_users (user_id, email) 
VALUES ('YOUR_USER_ID', 'YOUR_EMAIL');
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤
SELECT * FROM admin_users;

-- –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
DELETE FROM admin_users WHERE email = 'example@email.com';
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12)
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞** `/admin`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - `Checking admin access...`
   - `Admin check response: { isAdmin: true }`
   - `User is admin!`

## –ö–∞–∫ —É–≤–∏–¥–µ—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∞–¥–º–∏–Ω–∫—É

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ —Å–µ–±—è –≤ `admin_users`:

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** (F5)
2. **–í —Å–∞–π–¥–±–∞—Ä–µ** –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ **"◊ê◊ì◊û◊ô◊ü"** —Å –∏–∫–æ–Ω–∫–æ–π Shield
3. **–ù–∞–∂–º–∏—Ç–µ** –Ω–∞ –Ω–µ—ë ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å —Ç—ë–º–Ω—ã–º sidebar

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –≤–∏–∂—É –∫–Ω–æ–ø–∫—É "◊ê◊ì◊û◊ô◊ü" –≤ —Å–∞–π–¥–±–∞—Ä–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `admin_users`:
   ```sql
   SELECT * FROM admin_users WHERE email = 'YOUR_EMAIL';
   ```
2. –û—Ç–∫—Ä–æ–π—Ç–µ `/api/admin/check` –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å `{"isAdmin":true}`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∂—ë—Å—Ç–∫—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É: Ctrl+Shift+R (Windows) –∏–ª–∏ Cmd+Shift+R (Mac)

### –ü—Ä–æ–±–ª–µ–º–∞: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–π—Ç–∏ –Ω–∞ `/admin`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
   ```
   Checking admin access...
   Admin check response: ...
   ```
2. –ï—Å–ª–∏ `isAdmin: false` ‚Äî –≤—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `admin_users`
3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 401/500 ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ —Å API route, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞: RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–†–µ—à–µ–Ω–∏–µ:**
–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º API route `/api/admin/check` –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π RLS.
–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏:
   ```sql
   SELECT * FROM pg_policies WHERE tablename = 'admin_users';
   ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∞ "Admin only":
   ```sql
   CREATE POLICY "Admin only" ON admin_users FOR ALL USING (is_admin());
   ```

## –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞:

```sql
-- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
INSERT INTO organizations (name, email, category, plan) 
VALUES ('Test Org', 'test@example.com', 'other', 'basic')
RETURNING id;

-- –ü–æ–ª—É—á–∏—Ç—å ID –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT id, email FROM auth.users LIMIT 1;

-- –î–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –∫–∞–∫ –∞–¥–º–∏–Ω–∞
INSERT INTO admin_users (user_id, email) 
VALUES ('user_id_from_above', 'email_from_above');
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–¥–º–∏–Ω–∫–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

- **–¢—ë–º–Ω—ã–π sidebar** (#1E293B)
- **–†–∞–∑–¥–µ–ª—ã:**
  - üìä ◊ú◊ï◊ó ◊ë◊ß◊®◊î (–î–∞—à–±–æ—Ä–¥) ‚Üí `/admin`
  - üè¢ ◊ê◊®◊í◊ï◊†◊ô◊ù (–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏) ‚Üí `/admin/organizations`
  - üí∞ ◊ó◊ô◊ï◊ë◊ô◊ù (–ë–∏–ª–ª–∏–Ω–≥) ‚Üí `/admin/billing`
  - üì¢ ◊§◊®◊°◊ï◊ù (–†–µ–∫–ª–∞–º–∞) ‚Üí `/admin/ads`
  - ‚öôÔ∏è ◊î◊í◊ì◊®◊ï◊™ (–ù–∞—Å—Ç—Ä–æ–π–∫–∏) ‚Üí `/admin/settings`

–ì–æ—Ç–æ–≤–æ! üéâ
